# ĞŸĞ»Ğ°Ğ½ Ğ”Ğ¾Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ¾Ğº BookReader AI

**Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ:** 26 Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ 2025
**ĞÑĞ½Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ°:** ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ğ¾Ğ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (6 Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²)
**ĞĞ±Ñ‰Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ° ÑƒÑĞ¸Ğ»Ğ¸Ğ¹:** 760-1,070 Ñ‡Ğ°ÑĞ¾Ğ²

---

## ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### ĞœĞ°Ñ‚Ñ€Ğ¸Ñ†Ğ° ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ¾Ğ²

```
                    Ğ’Ğ›Ğ˜Ğ¯ĞĞ˜Ğ•
                ĞĞ¸Ğ·ĞºĞ¾Ğµ    Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    ĞĞ¸Ğ·ĞºĞ°Ñ â”‚    P4    â”‚    P2    â”‚
  Ğ£Ğ¡Ğ˜Ğ›Ğ˜Ğ¯   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ â”‚    P3    â”‚    P1    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸ ĞÑ‡ĞµÑ€ĞµĞ´Ğ½Ğ¾ÑÑ‚Ğ¸

1. **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** > Ğ’ÑÑ‘ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ (ĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ = Ğ¿Ğ¾Ñ‚ĞµÑ€Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ°)
2. **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒÑÑ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹** > Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ (sync I/O Ğ¼Ğ¾Ğ¶ĞµÑ‚ ĞºÑ€Ğ°ÑˆĞ¸Ñ‚ÑŒ production)
3. **ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°** > Ğ¢ĞµÑÑ‚Ñ‹ (ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ´ Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¼)
4. **Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** > Ğ¢ĞµÑÑ‚Ñ‹ (Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
5. **ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹** > Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ (LLM/Imagen = core business)

---

## ĞĞ±Ğ·Ğ¾Ñ€ Ğ¤Ğ°Ğ·

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TIMELINE                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ğ¤ĞĞ—Ğ 0  â”‚ Ğ¤ĞĞ—Ğ 1  â”‚     Ğ¤ĞĞ—Ğ 2      â”‚           Ğ¤ĞĞ—Ğ 3              â”‚
â”‚ 1-2 Ğ´Ğ½Ñ â”‚ 1 Ğ½ĞµĞ´ĞµĞ»Ñâ”‚    1 Ğ¼ĞµÑÑÑ†      â”‚         2-3 Ğ¼ĞµÑÑÑ†Ğ°            â”‚
â”‚         â”‚         â”‚                 â”‚                               â”‚
â”‚ HOTFIX  â”‚ SECURITYâ”‚   FOUNDATION    â”‚        COMPREHENSIVE          â”‚
â”‚         â”‚         â”‚                 â”‚                               â”‚
â”‚ Ğ¡ĞµĞºÑ€ĞµÑ‚Ñ‹ â”‚ JWT     â”‚ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°     â”‚ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ                  â”‚
â”‚         â”‚ IDOR    â”‚ Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ     â”‚ ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ                   â”‚
â”‚         â”‚         â”‚ Async I/O       â”‚ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¤ĞĞ—Ğ 0: HOTFIX (1-2 Ğ´Ğ½Ñ)

### Ğ¦ĞµĞ»ÑŒ
Ğ£ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿Ñ€Ğ¸Ğ²ĞµÑÑ‚Ğ¸ Ğº Ğ½ĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸

#### 0.1 Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ²ÑĞµÑ… ÑĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸ”´ P0 - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 2-4 Ñ‡Ğ°ÑĞ° |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | ĞĞµÑ‚ |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | Ğ’ÑÑ‘ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ |

**Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:**
```bash
# 1. Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹
openssl rand -hex 32  # SECRET_KEY
openssl rand -hex 32  # JWT_SECRET_KEY
openssl rand -hex 16  # DB_PASSWORD
openssl rand -hex 16  # REDIS_PASSWORD

# 2. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ° production ÑĞµÑ€Ğ²ĞµÑ€Ğµ
ssh production "vim /app/.env"

# 3. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
ssh production "docker-compose restart"

# 4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Google API Key
# https://console.cloud.google.com/apis/credentials

# 5. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ADMIN_PASSWORD, GRAFANA_ADMIN_PASSWORD
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] SECRET_KEY Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] JWT_SECRET_KEY Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] DB_PASSWORD Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] REDIS_PASSWORD Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] GOOGLE_API_KEY (Gemini) Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] ADMIN_PASSWORD Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] GRAFANA_ADMIN_PASSWORD Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] Ğ’ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ñ‹ Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚

---

#### 0.2 Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² Ğ¸Ğ· git Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸ”´ P0 - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 2-4 Ñ‡Ğ°ÑĞ° |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | 0.1 |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |

**Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:**
```bash
# 1. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ git-filter-repo (Ğ±Ğ¾Ğ»ĞµĞµ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ‡ĞµĞ¼ BFG)
pip install git-filter-repo

# 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ backup Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
git clone --mirror https://github.com/user/repo.git repo-backup.git

# 3. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸Ğ· Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
git filter-repo --path .env --invert-paths
git filter-repo --path backend/.env.production --invert-paths
git filter-repo --path backend/.env.example --invert-paths

# 4. Force push (ĞĞŸĞĞ¡ĞĞ - ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹!)
git push origin --force --all
git push origin --force --tags

# 5. Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ¸Ñ‚ÑŒ Ğ²ÑĞµÑ… Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² Ğ¾ re-clone
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] Backup Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] .env ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½ Ğ¸Ğ· Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
- [ ] backend/.env.production ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½ Ğ¸Ğ· Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
- [ ] Force push Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½
- [ ] Ğ’ÑĞµ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ñ‹
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾, Ñ‡Ñ‚Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ checkout ÑÑ‚Ğ°Ñ€Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²

---

#### 0.3 ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ .gitignore
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸ”´ P0 - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚ |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | 0.2 |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |

**Ğ¤Ğ°Ğ¹Ğ»:** `.gitignore`
```gitignore
# Environment files (NEVER commit!)
.env
.env.*
!.env.example
*.env

# Secrets
secrets/
credentials/
*.pem
*.key

# Backup files
*.bak
*.backup
*.old
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] .gitignore Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾ git status - Ğ½ĞµÑ‚ .env Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

---

### Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¤Ğ°Ğ·Ñ‹ 0
- âœ… Ğ’ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹
- âœ… Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ git Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ğ°
- âœ… Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ ÑƒÑ‚ĞµÑ‡ĞºĞ¸

---

## Ğ¤ĞĞ—Ğ 1: SECURITY (1 Ğ½ĞµĞ´ĞµĞ»Ñ)

### Ğ¦ĞµĞ»ÑŒ
Ğ£ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¸ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğµ ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸.

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸

#### 1.1 Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ JWT Token Blacklist
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸ”´ P1 - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 8-12 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | Ğ¤Ğ°Ğ·Ğ° 0 |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |
| **Ğ¤Ğ°Ğ¹Ğ»Ñ‹** | `backend/app/services/auth_service.py`, `backend/app/core/auth.py` |

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**

```python
# backend/app/services/token_blacklist.py (ĞĞĞ’Ğ«Ğ™ Ğ¤ĞĞ™Ğ›)
"""
Redis-based JWT token blacklist for secure logout.
"""
from datetime import datetime, timezone
from typing import Optional
from redis.asyncio import Redis

from app.core.cache import cache_manager


class TokenBlacklist:
    """Manages blacklisted JWT tokens in Redis."""

    PREFIX = "token_blacklist:"

    async def add(self, token: str, expires_at: datetime) -> bool:
        """
        Add token to blacklist.

        Args:
            token: JWT token to blacklist
            expires_at: When the token naturally expires

        Returns:
            True if added successfully
        """
        # Calculate TTL (only keep until natural expiration)
        now = datetime.now(timezone.utc)
        ttl_seconds = int((expires_at - now).total_seconds())

        if ttl_seconds <= 0:
            return True  # Already expired, no need to blacklist

        key = f"{self.PREFIX}{token}"
        await cache_manager.set(key, "1", ttl=ttl_seconds)
        return True

    async def is_blacklisted(self, token: str) -> bool:
        """Check if token is blacklisted."""
        key = f"{self.PREFIX}{token}"
        result = await cache_manager.get(key)
        return result is not None

    async def remove(self, token: str) -> bool:
        """Remove token from blacklist (for testing)."""
        key = f"{self.PREFIX}{token}"
        await cache_manager.delete(key)
        return True


token_blacklist = TokenBlacklist()
```

```python
# backend/app/core/auth.py - Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ¯
from app.services.token_blacklist import token_blacklist

async def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: AsyncSession = Depends(get_database_session),
) -> User:
    token = credentials.credentials

    # CHECK BLACKLIST FIRST
    if await token_blacklist.is_blacklisted(token):
        raise HTTPException(
            status_code=401,
            detail="Token has been revoked",
            headers={"WWW-Authenticate": "Bearer"},
        )

    # ... rest of validation
```

```python
# backend/app/routers/auth.py - Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ¯
from app.services.token_blacklist import token_blacklist

@router.post("/auth/logout", response_model=LogoutResponse)
async def logout_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
) -> LogoutResponse:
    token = credentials.credentials

    # Decode token to get expiration
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        exp = datetime.fromtimestamp(payload["exp"], tz=timezone.utc)

        # Add to blacklist
        await token_blacklist.add(token, exp)

    except JWTError:
        pass  # Token invalid anyway, no need to blacklist

    return LogoutResponse(message="Successfully logged out")
```

**Ğ¢ĞµÑÑ‚Ñ‹:**
```python
# backend/tests/test_token_blacklist.py
import pytest
from app.services.token_blacklist import token_blacklist

class TestTokenBlacklist:
    @pytest.mark.asyncio
    async def test_add_and_check_blacklisted(self):
        token = "test_token_123"
        expires_at = datetime.now(timezone.utc) + timedelta(hours=1)

        await token_blacklist.add(token, expires_at)

        assert await token_blacklist.is_blacklisted(token) is True

    @pytest.mark.asyncio
    async def test_not_blacklisted(self):
        assert await token_blacklist.is_blacklisted("unknown_token") is False

    @pytest.mark.asyncio
    async def test_logout_invalidates_token(self, client, authenticated_user):
        # Login
        response = await client.post("/api/v1/auth/login", ...)
        token = response.json()["access_token"]

        # Logout
        await client.post(
            "/api/v1/auth/logout",
            headers={"Authorization": f"Bearer {token}"}
        )

        # Try to use token
        response = await client.get(
            "/api/v1/books",
            headers={"Authorization": f"Bearer {token}"}
        )

        assert response.status_code == 401
        assert "revoked" in response.json()["detail"]
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] TokenBlacklist ÑĞµÑ€Ğ²Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] get_current_user Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ blacklist
- [ ] /auth/logout Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² blacklist
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚
- [ ] Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°

---

#### 1.2 Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞµĞ½Ğ¸Ğµ ÑÑ€Ğ¾ĞºĞ° Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Access Token
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P1 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 2 Ñ‡Ğ°ÑĞ° |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | 1.1 |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |
| **Ğ¤Ğ°Ğ¹Ğ»Ñ‹** | `backend/app/core/config.py`, `frontend/src/api/auth.ts` |

**Backend Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:**
```python
# backend/app/core/config.py
ACCESS_TOKEN_EXPIRE_MINUTES: int = 30  # Ğ‘Ñ‹Ğ»Ğ¾ 720 (12 Ñ‡Ğ°ÑĞ¾Ğ²)
REFRESH_TOKEN_EXPIRE_DAYS: int = 7     # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ refresh token
```

**Frontend Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:**
```typescript
// frontend/src/api/auth.ts
// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°

let refreshPromise: Promise<string> | null = null;

export async function refreshAccessToken(): Promise<string> {
  // ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğµ refresh Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
  if (refreshPromise) {
    return refreshPromise;
  }

  refreshPromise = (async () => {
    try {
      const refreshToken = localStorage.getItem('refresh_token');
      const response = await fetch('/api/v1/auth/refresh', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ refresh_token: refreshToken }),
      });

      if (!response.ok) {
        throw new Error('Refresh failed');
      }

      const { access_token } = await response.json();
      localStorage.setItem('access_token', access_token);
      return access_token;
    } finally {
      refreshPromise = null;
    }
  })();

  return refreshPromise;
}

// Interceptor Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ refresh
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401 && !error.config._retry) {
      error.config._retry = true;
      const newToken = await refreshAccessToken();
      error.config.headers.Authorization = `Bearer ${newToken}`;
      return apiClient(error.config);
    }
    return Promise.reject(error);
  }
);
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] ACCESS_TOKEN_EXPIRE_MINUTES = 30
- [ ] Refresh token endpoint ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] Frontend interceptor Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½
- [ ] Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ token refresh flow

---

#### 1.3 Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ IDOR ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P1 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 4 Ñ‡Ğ°ÑĞ° |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | ĞĞµÑ‚ |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |
| **Ğ¤Ğ°Ğ¹Ğ»Ñ‹** | `backend/app/routers/books/crud.py`, `backend/app/routers/images.py` |

**Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ /books/{book_id}/cover:**
```python
# backend/app/routers/books/crud.py

# Ğ‘Ğ«Ğ›Ğ:
@router.get("/{book_id}/cover")
async def get_book_cover(
    book: Book = Depends(get_any_book),  # ĞĞ• Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°!
):

# Ğ¡Ğ¢ĞĞ›Ğ:
@router.get("/{book_id}/cover")
async def get_book_cover(
    book: Book = Depends(get_user_book),  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
    current_user: User = Depends(get_current_active_user),
):
```

**Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ /images/file/{filename}:**
```python
# backend/app/routers/images.py

# Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
@router.get("/images/file/{filename}")
async def get_generated_image_file(
    filename: str,
    current_user: User = Depends(get_current_active_user),  # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ
    db: AsyncSession = Depends(get_database_session),
):
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ¸Ñ‚ ĞºĞ½Ğ¸Ğ³Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    image = await db.execute(
        select(GeneratedImage)
        .join(Description)
        .join(Chapter)
        .join(Book)
        .where(
            GeneratedImage.image_url.contains(filename),
            Book.user_id == current_user.id
        )
    )
    if not image.scalar_one_or_none():
        raise HTTPException(status_code=404, detail="Image not found")

    # ... return file

# Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Signed URLs (Ğ»ÑƒÑ‡ÑˆĞµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸)
@router.get("/images/file/{filename}")
async def get_generated_image_file(
    filename: str,
    signature: str = Query(...),  # ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ URL
    expires: int = Query(...),    # Ğ’Ñ€ĞµĞ¼Ñ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ
):
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
    expected_sig = hmac.new(
        settings.IMAGE_URL_SECRET.encode(),
        f"{filename}:{expires}".encode(),
        hashlib.sha256
    ).hexdigest()

    if not hmac.compare_digest(signature, expected_sig):
        raise HTTPException(status_code=403, detail="Invalid signature")

    if time.time() > expires:
        raise HTTPException(status_code=403, detail="URL expired")

    # ... return file
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] /books/{book_id}/cover Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ get_user_book
- [ ] /images/file/{filename} Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ñ‘Ğ½ (Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚)
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°

---

#### 1.4 ĞÑƒĞ´Ğ¸Ñ‚ Ğ¸ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… endpoints
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P1 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 4 Ñ‡Ğ°ÑĞ° |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | 1.3 |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ endpoints:**
```bash
# ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ²ÑĞµ endpoints Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
grep -r "get_any_book\|get_any_chapter\|get_any_image" backend/app/routers/
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ endpoints:**
- [ ] GET /books/{id} - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
- [ ] GET /books/{id}/chapters - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
- [ ] GET /chapters/{id} - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
- [ ] GET /descriptions/{chapter_id} - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
- [ ] POST /images/generate/{desc_id} - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
- [ ] GET /reading-sessions/* - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°

---

### Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¤Ğ°Ğ·Ñ‹ 1
- âœ… JWT logout Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾
- âœ… Ğ¢Ğ¾ĞºĞµĞ½Ñ‹ Ğ¶Ğ¸Ğ²ÑƒÑ‚ 30 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 12 Ñ‡Ğ°ÑĞ¾Ğ²
- âœ… Ğ’ÑĞµ IDOR ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑƒÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ñ‹
- âœ… Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ: 6.0 â†’ 8.0/10

---

## Ğ¤ĞĞ—Ğ 2: FOUNDATION (1 Ğ¼ĞµÑÑÑ†)

### Ğ¦ĞµĞ»ÑŒ
Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ‡Ğ½ÑƒÑ Ğ¾ÑĞ½Ğ¾Ğ²Ñƒ Ğ´Ğ»Ñ Ğ´Ğ°Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞµĞ³Ğ¾ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ñ: Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ´ Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¼.

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 2.1: Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (3-5 Ğ´Ğ½ĞµĞ¹)

#### 2.1.1 Ğ—Ğ°Ğ¼ĞµĞ½Ğ° print() Ğ½Ğ° structured logging
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P2 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 16-24 Ñ‡Ğ°ÑĞ° |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | Ğ¤Ğ°Ğ·Ğ° 1 |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸) |
| **Ğ¤Ğ°Ğ¹Ğ»Ñ‹** | Ğ’ĞµÑÑŒ backend (453 Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ° print) |

**Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°:**
```bash
pip install loguru
```

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:**
```python
# backend/app/core/logging.py (ĞĞĞ’Ğ«Ğ™ Ğ¤ĞĞ™Ğ›)
"""
Structured logging configuration using loguru.
"""
import sys
from loguru import logger
from app.core.config import settings


def setup_logging():
    """Configure application logging."""

    # Remove default handler
    logger.remove()

    # Console output (development)
    if settings.DEBUG:
        logger.add(
            sys.stderr,
            format="<green>{time:HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>",
            level="DEBUG",
            colorize=True,
        )
    else:
        # JSON output (production)
        logger.add(
            sys.stderr,
            format="{message}",
            level="INFO",
            serialize=True,  # JSON format
        )

    # File rotation (production)
    if not settings.DEBUG:
        logger.add(
            "/var/log/bookreader/app.log",
            rotation="100 MB",
            retention="7 days",
            compression="gz",
            level="INFO",
            serialize=True,
        )

        # Error file
        logger.add(
            "/var/log/bookreader/error.log",
            rotation="50 MB",
            retention="30 days",
            level="ERROR",
            serialize=True,
        )

    return logger


# Export configured logger
app_logger = setup_logging()
```

**ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ print â†’ logger:**
```python
# Ğ‘Ğ«Ğ›Ğ:
print(f"[UPLOAD] Request received from user: {current_user.email}")
print(f"[ERROR] Failed to parse book: {e}")

# Ğ¡Ğ¢ĞĞ›Ğ:
from app.core.logging import app_logger as logger

logger.info("Upload request received", user_email=current_user.email, book_title=title)
logger.error("Failed to parse book", book_id=str(book_id), error=str(e), exc_info=True)
```

**Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµĞ½Ñ‹:**
```python
# scripts/migrate_print_to_logger.py
import re
import os

def migrate_file(filepath):
    with open(filepath, 'r') as f:
        content = f.read()

    # Add import if not present
    if 'from app.core.logging import' not in content:
        # Add after other imports
        content = re.sub(
            r'(from app\.[^\n]+\n)(?!from app\.core\.logging)',
            r'\1from app.core.logging import app_logger as logger\n',
            content,
            count=1
        )

    # Replace print statements
    patterns = [
        (r'print\(f"\[(\w+)\] ([^"]+)"\)', r'logger.info("\2", context="\1")'),
        (r'print\(f"(\w+): \{([^}]+)\}"\)', r'logger.info("\1", \2=\2)'),
        (r'print\(f"([^"]+)"\)', r'logger.debug("\1")'),
    ]

    for pattern, replacement in patterns:
        content = re.sub(pattern, replacement, content)

    with open(filepath, 'w') as f:
        f.write(content)

# Run on all Python files
for root, dirs, files in os.walk('backend/app'):
    for file in files:
        if file.endswith('.py'):
            migrate_file(os.path.join(root, file))
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] loguru ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½
- [ ] logging.py ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸ĞµĞ¹
- [ ] Ğ’ÑĞµ print() Ğ·Ğ°Ğ¼ĞµĞ½ĞµĞ½Ñ‹ Ğ½Ğ° logger.*
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾ Ğ² dev Ğ¸ production Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°Ñ…
- [ ] Log rotation Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

---

#### 2.1.2 Ğ—Ğ°Ğ¼ĞµĞ½Ğ° console.log Ğ½Ğ° ÑƒÑĞ»Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Frontend)
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ¡ P3 - Ğ¡Ğ Ğ•Ğ”ĞĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 8 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | ĞĞµÑ‚ |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |
| **Ğ¤Ğ°Ğ¹Ğ»Ñ‹** | Ğ’ĞµÑÑŒ frontend (281 Ğ²Ñ‹Ğ·Ğ¾Ğ²) |

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ logger:**
```typescript
// frontend/src/utils/logger.ts
type LogLevel = 'debug' | 'info' | 'warn' | 'error';

const isDev = import.meta.env.DEV;

interface Logger {
  debug: (...args: unknown[]) => void;
  info: (...args: unknown[]) => void;
  warn: (...args: unknown[]) => void;
  error: (...args: unknown[]) => void;
}

export const logger: Logger = {
  debug: (...args) => isDev && console.debug('[DEBUG]', ...args),
  info: (...args) => isDev && console.info('[INFO]', ...args),
  warn: (...args) => console.warn('[WARN]', ...args),  // Always show warnings
  error: (...args) => console.error('[ERROR]', ...args), // Always show errors
};

// Usage:
// import { logger } from '@/utils/logger';
// logger.debug('Loading book', { bookId });
// logger.error('Failed to load', error);
```

**ĞœĞ°ÑÑĞ¾Ğ²Ğ°Ñ Ğ·Ğ°Ğ¼ĞµĞ½Ğ°:**
```bash
# Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ console.log Ğ½Ğ° logger.debug
find frontend/src -name "*.ts" -o -name "*.tsx" | xargs sed -i '' 's/console.log(/logger.debug(/g'

# Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ console.warn Ğ½Ğ° logger.warn
find frontend/src -name "*.ts" -o -name "*.tsx" | xargs sed -i '' 's/console.warn(/logger.warn(/g'

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ (Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ¸Ğ»Ğ¸ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ¼)
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] logger.ts ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] Ğ’ÑĞµ console.log Ğ·Ğ°Ğ¼ĞµĞ½ĞµĞ½Ñ‹
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾ Ğ² production build (Ğ½ĞµÑ‚ debug Ğ»Ğ¾Ğ³Ğ¾Ğ²)

---

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 2.2: Async I/O (3-5 Ğ´Ğ½ĞµĞ¹)

#### 2.2.1 ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° aiofiles
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸ”´ P1 - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 8-12 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | ĞĞµÑ‚ |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ |
| **Ğ¤Ğ°Ğ¹Ğ»Ñ‹** | `backend/app/services/book/book_service.py`, `backend/app/services/book_parser.py` |

**Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°:**
```bash
pip install aiofiles
```

**ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ:**
```python
# Ğ‘Ğ«Ğ›Ğ (blocking):
with open(cover_path, "wb") as f:
    f.write(image_data)

os.remove(file_path)
os.makedirs(dir_path)

# Ğ¡Ğ¢ĞĞ›Ğ (non-blocking):
import aiofiles
import aiofiles.os

async with aiofiles.open(cover_path, "wb") as f:
    await f.write(image_data)

await aiofiles.os.remove(file_path)
await aiofiles.os.makedirs(dir_path, exist_ok=True)
```

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸:**
1. `backend/app/services/book/book_service.py`:
   - `_save_book_cover()` - Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸
   - `delete_book()` - ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° ĞºĞ½Ğ¸Ğ³Ğ¸

2. `backend/app/services/book_parser.py`:
   - Ğ’ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ/Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

3. `backend/app/routers/books/crud.py`:
   - `upload_book()` - ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] aiofiles ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½
- [ ] book_service.py Ğ¼Ğ¸Ğ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] book_parser.py Ğ¼Ğ¸Ğ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚
- [ ] ĞĞµÑ‚ sync file I/O Ğ² async Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑÑ… (grep Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°)

---

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 2.3: Dependency Injection (5-7 Ğ´Ğ½ĞµĞ¹)

#### 2.3.1 Ğ ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¸Ğ½Ğ³Ğ»Ñ‚Ğ¾Ğ½Ğ¾Ğ²
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P2 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 24-32 Ñ‡Ğ°ÑĞ° |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | 2.1 (Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ) |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ´Ğ»Ñ mock) |
| **Ğ¤Ğ°Ğ¹Ğ»Ñ‹** | Ğ’ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (12 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²) |

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ DI ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°:**
```python
# backend/app/core/container.py (ĞĞĞ’Ğ«Ğ™ Ğ¤ĞĞ™Ğ›)
"""
Dependency injection container for services.
"""
from functools import lru_cache
from typing import Generator

from fastapi import Depends
from sqlalchemy.ext.asyncio import AsyncSession

from app.core.database import get_database_session
from app.services.auth_service import AuthService
from app.services.book.book_service import BookService
from app.services.book.book_progress_service import BookProgressService
from app.services.book.book_parsing_service import BookParsingService
from app.services.book_parser import BookParser
from app.services.gemini_extractor import GeminiExtractor
from app.services.imagen_generator import ImagenGenerator


# Service factories (cached per request)

@lru_cache()
def get_auth_service() -> AuthService:
    """Get AuthService instance."""
    return AuthService()


@lru_cache()
def get_book_service() -> BookService:
    """Get BookService instance."""
    return BookService()


@lru_cache()
def get_book_progress_service() -> BookProgressService:
    """Get BookProgressService instance."""
    return BookProgressService()


@lru_cache()
def get_book_parser() -> BookParser:
    """Get BookParser instance."""
    return BookParser()


def get_gemini_extractor() -> GeminiExtractor:
    """Get GeminiExtractor instance (not cached - has state)."""
    return GeminiExtractor()


def get_imagen_generator() -> ImagenGenerator:
    """Get ImagenGenerator instance (not cached - has state)."""
    return ImagenGenerator()
```

**ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ğ¾Ğ²:**
```python
# Ğ‘Ğ«Ğ›Ğ:
from app.services.book import book_service

@router.get("/books")
async def get_books(...):
    return await book_service.get_books(db, user_id)

# Ğ¡Ğ¢ĞĞ›Ğ:
from app.core.container import get_book_service

@router.get("/books")
async def get_books(
    ...,
    book_service: BookService = Depends(get_book_service),
):
    return await book_service.get_books(db, user_id)
```

**ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ (Ğ¿Ğ¾ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼):**
1. `auth_service.py` â†’ Ğ½ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
2. `book_parser.py` â†’ Ğ½ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
3. `book_service.py` â†’ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ book_parser
4. `gemini_extractor.py` â†’ Ğ½ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
5. `imagen_generator.py` â†’ Ğ½ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
6. `image_generator.py` â†’ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ imagen_generator
7. ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] container.py ÑĞ¾Ğ·Ğ´Ğ°Ğ½
- [ ] auth_service Ğ¼Ğ¸Ğ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] book_service Ğ¼Ğ¸Ğ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- [ ] Ğ’ÑĞµ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹
- [ ] Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ½Ğ³Ğ»Ñ‚Ğ¾Ğ½Ñ‹ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹
- [ ] Ğ¢ĞµÑÑ‚Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ñ mock

---

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 2.4: Ğ ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ (3-5 Ğ´Ğ½ĞµĞ¹)

#### 2.4.1 Ğ’Ñ‹Ğ½Ğ¾Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ğ¸Ğ· ORM Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P2 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 16-20 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | 2.3 (DI) |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |
| **Ğ¤Ğ°Ğ¹Ğ»Ñ‹** | `backend/app/models/book.py`, `backend/app/models/chapter.py` |

**Book.get_user_progress â†’ BookProgressService:**
```python
# Ğ‘Ğ«Ğ›Ğ (Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸):
class Book(Base):
    def get_user_progress(self, user_id: UUID) -> "ReadingProgress | None":
        for progress in self.reading_progress:
            if progress.user_id == user_id:
                return progress
        return None

# Ğ¡Ğ¢ĞĞ›Ğ (Ğ² ÑĞµÑ€Ğ²Ğ¸ÑĞµ):
class BookProgressService:
    async def get_user_progress(
        self, db: AsyncSession, book_id: UUID, user_id: UUID
    ) -> ReadingProgress | None:
        result = await db.execute(
            select(ReadingProgress)
            .where(
                ReadingProgress.book_id == book_id,
                ReadingProgress.user_id == user_id
            )
        )
        return result.scalar_one_or_none()
```

**Book.calculate_progress_percent â†’ BookProgressService:**
```python
# ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ ~40 ÑÑ‚Ñ€Ğ¾Ğº Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ğ² BookProgressService.calculate_progress_percent()
```

**Chapter.check_is_service_page â†’ ChapterClassificationService:**
```python
# backend/app/services/chapter_classification_service.py (ĞĞĞ’Ğ«Ğ™ Ğ¤ĞĞ™Ğ›)
class ChapterClassificationService:
    SERVICE_PAGE_KEYWORDS = ["ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ", "Ğ¾Ğ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ", ...]

    def is_service_page(self, chapter: Chapter) -> bool:
        # Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
        pass
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] get_user_progress Ğ¿ĞµÑ€ĞµĞ½ĞµÑÑ‘Ğ½ Ğ² ÑĞµÑ€Ğ²Ğ¸Ñ
- [ ] calculate_progress_percent Ğ¿ĞµÑ€ĞµĞ½ĞµÑÑ‘Ğ½ Ğ² ÑĞµÑ€Ğ²Ğ¸Ñ
- [ ] check_is_service_page Ğ¿ĞµÑ€ĞµĞ½ĞµÑÑ‘Ğ½ Ğ² ÑĞµÑ€Ğ²Ğ¸Ñ
- [ ] ĞœĞ¾Ğ´ĞµĞ»Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
- [ ] Ğ’ÑĞµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹

---

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 2.5: Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (3-5 Ğ´Ğ½ĞµĞ¹)

#### 2.5.1 Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ğ‘Ğ”
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ¡ P2 - Ğ¡Ğ Ğ•Ğ”ĞĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 8-12 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | ĞĞµÑ‚ |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |

**ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ:**
```python
# alembic/versions/2025_12_27_fix_db_issues.py
"""Fix database issues from code review."""

def upgrade():
    # 1. Add unique constraint on reading_progress
    op.create_unique_constraint(
        'uq_reading_progress_user_book',
        'reading_progress',
        ['user_id', 'book_id']
    )

    # 2. Add unique constraint on chapters
    op.create_unique_constraint(
        'uq_chapters_book_number',
        'chapters',
        ['book_id', 'chapter_number']
    )

    # 3. Add cascade delete
    op.drop_constraint('books_user_id_fkey', 'books', type_='foreignkey')
    op.create_foreign_key(
        'books_user_id_fkey',
        'books', 'users',
        ['user_id'], ['id'],
        ondelete='CASCADE'
    )

    # 4. Convert entities_mentioned to JSONB
    op.alter_column(
        'descriptions',
        'entities_mentioned',
        type_=postgresql.JSONB,
        postgresql_using='entities_mentioned::jsonb'
    )

def downgrade():
    # Reverse operations
    pass
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] UniqueConstraint Ğ½Ğ° reading_progress Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½
- [ ] UniqueConstraint Ğ½Ğ° chapters Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½
- [ ] CASCADE DELETE Ğ½Ğ° books.user_id
- [ ] entities_mentioned ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² JSONB
- [ ] ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ½Ğ° staging

---

### Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¤Ğ°Ğ·Ñ‹ 2
- âœ… Structured logging Ğ²ĞµĞ·Ğ´Ğµ
- âœ… Async I/O Ğ´Ğ»Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- âœ… Dependency Injection Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ÑĞ¸Ğ½Ğ³Ğ»Ñ‚Ğ¾Ğ½Ğ¾Ğ²
- âœ… Ğ§Ğ¸ÑÑ‚Ñ‹Ğµ ORM Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
- âœ… Ğ‘Ğ” constraints Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ñ‹
- âœ… ĞšĞ¾Ğ´ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

---

## Ğ¤ĞĞ—Ğ 3: COMPREHENSIVE (2-3 Ğ¼ĞµÑÑÑ†Ğ°)

### Ğ¦ĞµĞ»ÑŒ
Ğ”Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ production-ready ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°: Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ, Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸, Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ.

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 3.1: ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‚ĞµÑÑ‚Ñ‹ Backend (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 3.1.1 Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ LLM ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸ”´ P1 - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 60-80 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | Ğ¤Ğ°Ğ·Ğ° 2 (DI Ğ´Ğ»Ñ mock) |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | Ğ ĞµĞ»Ğ¸Ğ· Ğ½Ğ¾Ğ²Ñ‹Ñ… LLM Ñ„Ğ¸Ñ‡ |

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ñ‚ĞµÑÑ‚Ğ¾Ğ²:**
1. `tests/services/test_gemini_extractor.py` (~800 ÑÑ‚Ñ€Ğ¾Ğº, 50 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
2. `tests/services/test_imagen_generator.py` (~900 ÑÑ‚Ñ€Ğ¾Ğº, 60 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
3. `tests/services/test_langextract_processor.py` (~600 ÑÑ‚Ñ€Ğ¾Ğº, 40 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
4. `tests/services/test_llm_description_enricher.py` (~500 ÑÑ‚Ñ€Ğ¾Ğº, 35 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)

**ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ñ‚ĞµÑÑ‚Ğ¾Ğ²:**
- Basic functionality (happy path)
- Error handling (API errors, timeouts, rate limits)
- Edge cases (empty input, malformed responses)
- Cost optimization (caching, token limits)
- Retry logic (exponential backoff)

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹:**
```python
# tests/services/test_gemini_extractor.py
class TestGeminiExtractorBasic:
    """Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»."""
    async def test_extract_descriptions_success(self): ...
    async def test_extract_empty_text(self): ...
    async def test_extract_russian_text(self): ...

class TestGeminiExtractorErrors:
    """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº."""
    async def test_rate_limit_429(self): ...
    async def test_quota_exceeded_503(self): ...
    async def test_timeout_handling(self): ...
    async def test_malformed_json_response(self): ...

class TestGeminiExtractorRetry:
    """Retry Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°."""
    async def test_retry_on_transient_error(self): ...
    async def test_exponential_backoff(self): ...
    async def test_max_retries_exceeded(self): ...

class TestGeminiExtractorCaching:
    """ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ."""
    async def test_cache_hit(self): ...
    async def test_cache_invalidation(self): ...

class TestGeminiExtractorTranslation:
    """ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´ RUâ†’EN."""
    async def test_russian_to_english(self): ...
    async def test_preserves_meaning(self): ...
```

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚:**
- [ ] test_gemini_extractor.py: 50+ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
- [ ] test_imagen_generator.py: 60+ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
- [ ] test_langextract_processor.py: 40+ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
- [ ] test_llm_description_enricher.py: 35+ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
- [ ] Coverage LLM ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²: 70%+

---

#### 3.1.2 Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Cache ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P2 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 20-30 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | 3.1.1 |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | ĞĞµÑ‚ |

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
1. `tests/services/test_reading_session_cache.py` (~500 ÑÑ‚Ñ€Ğ¾Ğº)
2. `tests/services/test_settings_manager.py` (~400 ÑÑ‚Ñ€Ğ¾Ğº)

---

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 3.2: Frontend Ñ‚ĞµÑÑ‚Ñ‹ (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 3.2.1 Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Custom Hooks
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸ”´ P1 - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 60-80 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | ĞĞµÑ‚ |
| **Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | Ğ ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ hooks |

**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½Ñ‹Ğµ hooks (Ğ¿Ğ¾ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸):**
1. `useDescriptionHighlighting.test.ts` (~400 ÑÑ‚Ñ€Ğ¾Ğº, 25 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
2. `useEpubLoader.test.ts` (~500 ÑÑ‚Ñ€Ğ¾Ğº, 30 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
3. `useCFITracking.test.ts` (~600 ÑÑ‚Ñ€Ğ¾Ğº, 35 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
4. `useChapterManagement.test.ts` (~400 ÑÑ‚Ñ€Ğ¾Ğº, 25 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
5. `useImageModal.test.ts` (~350 ÑÑ‚Ñ€Ğ¾Ğº, 20 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)

**ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ñ‚ĞµÑÑ‚Ğ¾Ğ²:**
- Rendering states (loading, error, success)
- User interactions (clicks, navigation)
- Edge cases (empty data, large data)
- Memory management (cleanup on unmount)
- Performance (debouncing, memoization)

---

#### 3.2.2 Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P2 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 40-50 Ñ‡Ğ°ÑĞ¾Ğ² |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | 3.2.1 |

**ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**
1. `ImageModal.test.tsx` (~300 ÑÑ‚Ñ€Ğ¾Ğº)
2. `BookUploadModal.test.tsx` (~250 ÑÑ‚Ñ€Ğ¾Ğº)
3. `ReaderControls.test.tsx` (~200 ÑÑ‚Ñ€Ğ¾Ğº)
4. `Admin/*.test.tsx` (~500 ÑÑ‚Ñ€Ğ¾Ğº total)

---

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 3.3: Integration Ñ‚ĞµÑÑ‚Ñ‹ (2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 3.3.1 End-to-end Ñ‚ĞµÑÑ‚Ñ‹ Backend
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ  P2 - Ğ’Ğ«Ğ¡ĞĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 30-40 Ñ‡Ğ°ÑĞ¾Ğ² |

**Flows:**
1. Upload â†’ Parse â†’ Extract â†’ Generate Image
2. Concurrent users reading same book
3. Offline â†’ Online sync
4. Rate limiting validation

---

#### 3.3.2 E2E Ñ‚ĞµÑÑ‚Ñ‹ Frontend
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ¡ P3 - Ğ¡Ğ Ğ•Ğ”ĞĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 20-30 Ñ‡Ğ°ÑĞ¾Ğ² |

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Playwright Ğ¸Ğ»Ğ¸ Cypress:**
```typescript
// e2e/reading-flow.spec.ts
test('complete reading flow', async ({ page }) => {
  // Login
  await page.goto('/login');
  await page.fill('[name="email"]', 'test@example.com');
  await page.fill('[name="password"]', 'password123');
  await page.click('button[type="submit"]');

  // Upload book
  await page.click('text=Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ½Ğ¸Ğ³Ñƒ');
  await page.setInputFiles('input[type="file"]', 'test-book.epub');
  await page.click('text=Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ');

  // Wait for parsing
  await expect(page.locator('text=ĞšĞ½Ğ¸Ğ³Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ°')).toBeVisible({ timeout: 30000 });

  // Open and read
  await page.click('text=test-book');
  await expect(page.locator('[data-testid="epub-viewer"]')).toBeVisible();

  // Check highlights
  await expect(page.locator('.description-highlight')).toHaveCount({ min: 1 });
});
```

---

### Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚ 3.4: ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

#### 3.4.1 Frontend Ğ¼ĞµĞ¼Ğ¾Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ¡ P3 - Ğ¡Ğ Ğ•Ğ”ĞĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 8-12 Ñ‡Ğ°ÑĞ¾Ğ² |

**ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ React.memo:**
- BookCard
- LibraryStats
- ChapterList
- DescriptionItem

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ useMemo/useCallback:**
- getBackgroundColor Ğ² EpubReader
- Theme-related calculations
- Filter/sort functions

---

#### 3.4.2 ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¼Ñ‘Ñ€Ñ‚Ğ²Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°
| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚** | ğŸŸ¢ P4 - ĞĞ˜Ğ—ĞšĞ˜Ğ™ |
| **Ğ£ÑĞ¸Ğ»Ğ¸Ñ** | 4-6 Ñ‡Ğ°ÑĞ¾Ğ² |

**Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ:**
- 109 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² .bak
- 5 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² *Old.tsx
- Ğ—Ğ°ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´
- Ğ£ÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğµ NLP ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸

```bash
# Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ .bak Ñ„Ğ°Ğ¹Ğ»Ñ‹
find frontend/src -name "*.bak" -delete

# Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ *Old.tsx
rm frontend/src/pages/*Old.tsx
```

---

### Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¤Ğ°Ğ·Ñ‹ 3
- âœ… Backend coverage: 70%+
- âœ… Frontend coverage: 50%+
- âœ… E2E Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… flows
- âœ… ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
- âœ… Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ±ĞµĞ· Ğ¼Ñ‘Ñ€Ñ‚Ğ²Ñ‹Ñ… ÑƒÑ‡Ğ°ÑÑ‚ĞºĞ¾Ğ²

---

## Ğ¡Ğ²Ğ¾Ğ´Ğ½Ğ°Ñ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ—Ğ°Ğ´Ğ°Ñ‡

### ĞŸĞ¾ ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ

| ID | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ | Ğ£ÑĞ¸Ğ»Ğ¸Ñ | Ğ¤Ğ°Ğ·Ğ° |
|----|--------|-----------|--------|------|
| 0.1 | Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² | ğŸ”´ P0 | 2-4Ñ‡ | 0 |
| 0.2 | ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° git Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ | ğŸ”´ P0 | 2-4Ñ‡ | 0 |
| 1.1 | JWT blacklist | ğŸ”´ P1 | 8-12Ñ‡ | 1 |
| 2.2.1 | Async I/O (aiofiles) | ğŸ”´ P1 | 8-12Ñ‡ | 2 |
| 3.1.1 | Ğ¢ĞµÑÑ‚Ñ‹ LLM ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² | ğŸ”´ P1 | 60-80Ñ‡ | 3 |
| 3.2.1 | Ğ¢ĞµÑÑ‚Ñ‹ hooks | ğŸ”´ P1 | 60-80Ñ‡ | 3 |
| 1.2 | Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ÑŒ token TTL | ğŸŸ  P1 | 2Ñ‡ | 1 |
| 1.3 | Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ IDOR | ğŸŸ  P1 | 4Ñ‡ | 1 |
| 2.1.1 | Logging (printâ†’loguru) | ğŸŸ  P2 | 16-24Ñ‡ | 2 |
| 2.3.1 | Dependency Injection | ğŸŸ  P2 | 24-32Ñ‡ | 2 |
| 2.4.1 | Ğ ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ | ğŸŸ  P2 | 16-20Ñ‡ | 2 |
| 3.1.2 | Ğ¢ĞµÑÑ‚Ñ‹ Cache | ğŸŸ  P2 | 20-30Ñ‡ | 3 |
| 3.2.2 | Ğ¢ĞµÑÑ‚Ñ‹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² | ğŸŸ  P2 | 40-50Ñ‡ | 3 |
| 3.3.1 | Integration Ñ‚ĞµÑÑ‚Ñ‹ | ğŸŸ  P2 | 30-40Ñ‡ | 3 |
| 2.1.2 | Frontend logging | ğŸŸ¡ P3 | 8Ñ‡ | 2 |
| 2.5.1 | Ğ‘Ğ” constraints | ğŸŸ¡ P3 | 8-12Ñ‡ | 2 |
| 3.3.2 | E2E Ñ‚ĞµÑÑ‚Ñ‹ | ğŸŸ¡ P3 | 20-30Ñ‡ | 3 |
| 3.4.1 | ĞœĞµĞ¼Ğ¾Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ | ğŸŸ¡ P3 | 8-12Ñ‡ | 3 |
| 3.4.2 | ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ĞºĞ¾Ğ´Ğ° | ğŸŸ¢ P4 | 4-6Ñ‡ | 3 |

### Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

```
Ğ¤ĞĞ—Ğ 0: HOTFIX
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.1 Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ²â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.2 ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° git     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
Ğ¤ĞĞ—Ğ 1: SECURITY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.1 JWT blacklist   â”‚â”€â”€â”€â”€â–¶â”‚ 1.2 Token TTL       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.3 IDOR fix        â”‚â”€â”€â”€â”€â–¶â”‚ 1.4 Audit endpoints â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
Ğ¤ĞĞ—Ğ 2: FOUNDATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2.1.1 Logging       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2.2.1 Async I/O     â”‚     â”‚ 2.1.2 Frontend log  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2.3.1 DI Container  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2.4.1 Model refactorâ”‚     â”‚ 2.5.1 DB constraintsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
Ğ¤ĞĞ—Ğ 3: COMPREHENSIVE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.1.1 LLM tests     â”‚     â”‚ 3.2.1 Hooks tests   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                           â”‚
           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.1.2 Cache tests   â”‚     â”‚ 3.2.2 Component testâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ 3.3 Integration     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ 3.4 Optimization    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ£ÑĞ¿ĞµÑ…Ğ°

### ĞŸĞ¾ÑĞ»Ğµ Ğ¤Ğ°Ğ·Ñ‹ 0 (1-2 Ğ´Ğ½Ñ)
- [ ] Ğ’ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹
- [ ] .env Ñ„Ğ°Ğ¹Ğ»Ñ‹ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ· git Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
- [ ] Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ ÑƒÑ‚ĞµÑ‡ĞºĞ¸

### ĞŸĞ¾ÑĞ»Ğµ Ğ¤Ğ°Ğ·Ñ‹ 1 (1 Ğ½ĞµĞ´ĞµĞ»Ñ)
- [ ] Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ: 6.0 â†’ 8.0/10
- [ ] JWT logout Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
- [ ] IDOR ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑƒÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ñ‹

### ĞŸĞ¾ÑĞ»Ğµ Ğ¤Ğ°Ğ·Ñ‹ 2 (1 Ğ¼ĞµÑÑÑ†)
- [ ] ĞĞµÑ‚ sync I/O Ğ² async Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑÑ…
- [ ] ĞĞµÑ‚ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¸Ğ½Ğ³Ğ»Ñ‚Ğ¾Ğ½Ğ¾Ğ²
- [ ] Structured logging Ğ²ĞµĞ·Ğ´Ğµ
- [ ] ĞšĞ¾Ğ´ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### ĞŸĞ¾ÑĞ»Ğµ Ğ¤Ğ°Ğ·Ñ‹ 3 (3 Ğ¼ĞµÑÑÑ†Ğ°)
- [ ] Backend coverage: 70%+
- [ ] Frontend coverage: 50%+
- [ ] E2E Ñ‚ĞµÑÑ‚Ñ‹: 10+ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… flows
- [ ] ĞĞ±Ñ‰Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°: 6.5 â†’ 8.5/10

---

## Ğ ĞµÑÑƒÑ€ÑÑ‹

### ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ°Ñ)
- 1 Senior Backend Developer (Python/FastAPI)
- 1 Senior Frontend Developer (React/TypeScript)
- 1 DevSecOps Engineer (Ñ‡Ğ°ÑÑ‚ÑŒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸)
- 1 QA Engineer

### Ğ‘ÑĞ´Ğ¶ĞµÑ‚
| Ğ¤Ğ°Ğ·Ğ° | Ğ§Ğ°ÑÑ‹ | Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ ($100/Ñ‡Ğ°Ñ) |
|------|------|----------------------|
| 0 | 4-8 | $400-800 |
| 1 | 20-30 | $2,000-3,000 |
| 2 | 80-120 | $8,000-12,000 |
| 3 | 250-350 | $25,000-35,000 |
| **Ğ˜Ñ‚Ğ¾Ğ³Ğ¾** | **354-508** | **$35,400-50,800** |

---

**ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾:** Claude Opus 4.5
**Ğ”Ğ°Ñ‚Ğ°:** 26 Ğ´ĞµĞºĞ°Ğ±Ñ€Ñ 2025
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0
