# –ê–Ω–∞–ª–∏–∑ BookReader AI –∫–∞–∫ –í–µ–±-–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ß—Ç–µ–Ω–∏—è

**–î–∞—Ç–∞:** 27 –¥–µ–∫–∞–±—Ä—è 2025
**–§–æ–∫—É—Å:** UX –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è –∫–Ω–∏–≥

---

## –†–µ–∑—é–º–µ

BookReader AI –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ (Kindle, Google Play Books, LitRes, Bookmate). –í—ã—è–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º —á—Ç–µ–Ω–∏–∏.

### –û–±—â–∞—è –û—Ü–µ–Ω–∫–∞: 5.5/10

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (CFI) | 8/10 | –û—Ç–ª–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å hybrid approach |
| Cross-device sync | 2/10 | **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–±–µ–ª** |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–ª–∞–≤ | 8/10 | –•–æ—Ä–æ—à–∞—è –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| Offline support | 3/10 | –¢–æ–ª—å–∫–æ –∫—ç—à, –Ω–µ—Ç queue |
| Error handling | 4/10 | –ù–µ—Ç user notifications |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 6/10 | –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞ –±–æ–ª—å—à–∏—Ö –∫–Ω–∏–≥–∞—Ö |

---

## 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –¢–æ–∫–µ–Ω–æ–º –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ß—Ç–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`backend/app/core/config.py`):**
```python
ACCESS_TOKEN_EXPIRE_MINUTES: int = 720  # 12 —á–∞—Å–æ–≤
REFRESH_TOKEN_EXPIRE_DAYS: int = 7
```

**–í—ã–≤–æ–¥:** –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ 12 —á–∞—Å–æ–≤ ‚Äî —ç—Ç–æ –ù–û–†–ú–ê–õ–¨–ù–û –¥–ª—è —Å–µ—Å—Å–∏–∏ —á—Ç–µ–Ω–∏—è.

### –†–µ–∞–ª—å–Ω–∞—è –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞, –∞ –≤ **–ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –µ–≥–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏**:

1. **Silent refresh —Ä–∞–±–æ—Ç–∞–µ—Ç** (`frontend/src/api/client.ts:57-97`)
2. **–ù–û –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ refresh token** (7 –¥–Ω–µ–π) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π logout
3. **–ü—Ä–∏ logout –æ—á–∏—â–∞—é—Ç—Å—è –í–°–ï –∫—ç—à–∏** (`clearAllCaches()`) ‚Äî –≤–∫–ª—é—á–∞—è –ª–æ–∫–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é —á—Ç–µ–Ω–∏—è

**–§–∞–π–ª:** `frontend/src/stores/auth.ts:89-117`
```typescript
logout: async () => {
  // CRITICAL: Clear all caches to prevent data leakage to next user
  await clearAllCaches(); // ‚Üê –£–¥–∞–ª—è–µ—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—è –ø–æ–∑–∏—Ü–∏—é!
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π –ü–æ—Ç–µ—Ä–∏ –î–∞–Ω–Ω—ã—Ö

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç –∫–Ω–∏–≥—É –Ω–µ–¥–µ–ª—é
2. –ù–µ –∑–∞—Ö–æ–¥–∏—Ç 8 –¥–Ω–µ–π
3. Refresh token –∏—Å—Ç–µ–∫–∞–µ—Ç
4. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ ‚Äî logout + –ø–æ—Ç–µ—Ä—è –≤—Å–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
5. –ü–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ ‚Äî –ø–æ–∑–∏—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞ (–∫–æ—Ç–æ—Ä–∞—è –º–æ–≥–ª–∞ –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–°–æ—Ö—Ä–∞–Ω—è—Ç—å reading progress –≤ localStorage –î–û –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–µ–π:**
```typescript
logout: async () => {
  // 1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ —á—Ç–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª—é—á
  const progressBackup = await backupReadingProgress();
  localStorage.setItem('reading_progress_backup', JSON.stringify(progressBackup));

  // 2. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à–∏
  await clearAllCaches();

  // 3. –ü–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
}
```

---

## 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –°—Ç—Ä–∞–Ω–∏—Ü—ã

### –ß—Ç–æ –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –°–µ–π—á–∞—Å

–ü—Ä–∏ —Å–ª—É—á–∞–π–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5 / swipe down –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö):

1. ‚úÖ –ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (debounce 5 —Å–µ–∫)
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `keepalive: true` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
3. ‚ùå –ù–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏ F5
4. ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞"

**–§–∞–π–ª:** `frontend/src/hooks/epub/useProgressSync.ts`
```typescript
// Debounce 5 —Å–µ–∫—É–Ω–¥ - –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–∏–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–∞–Ω—å—à–µ, –ø–æ–∑–∏—Ü–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è!
const DEBOUNCE_MS = 5000;
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**1. –£–º–µ–Ω—å—à–∏—Ç—å debounce –¥–æ 2 —Å–µ–∫—É–Ω–¥ –¥–ª—è —á—Ç–µ–Ω–∏—è:**
```typescript
const DEBOUNCE_MS = 2000; // –ö–æ–º–ø—Ä–æ–º–∏—Å—Å –º–µ–∂–¥—É UX –∏ –Ω–∞–≥—Ä—É–∑–∫–æ–π
```

**2. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ beforeunload:**
```typescript
const handleBeforeUnload = () => {
  // –û—Ç–º–µ–Ω–∏—Ç—å pending debounce –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
  if (pendingUpdate.current) {
    clearTimeout(debounceTimer);
    saveImmediately(); // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π fetch —Å keepalive
  }
};
```

**3. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ":**
```typescript
// –ú–∏–Ω–∏-—Ç–æ—Å—Ç –≤ —É–≥–ª—É: "‚úì –ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞"
<ProgressSaveIndicator lastSaved={lastSavedAt} />
```

---

## 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ú–µ–∂–¥—É –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

### –ö–∞–∫ –†–∞–±–æ—Ç–∞—é—Ç –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã

| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –ü–æ–¥—Ö–æ–¥ |
|------------|--------|
| **Kindle** | Whispersync ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ WebSocket |
| **Google Books** | Polling –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ + sync on open |
| **LitRes** | Sync on open + push notifications |
| **Bookmate** | Real-time sync + conflict resolution dialog |

### BookReader AI

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ùå –ù–µ—Ç sync on open
- ‚ùå –ù–µ—Ç conflict resolution
- ‚ùå –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–∞–∑–ª–∏—á–∏–∏ –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**1. Sync on Open:**
```typescript
// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–Ω–∏–≥–∏
const openBook = async (bookId) => {
  const serverProgress = await api.getReadingProgress(bookId);
  const localProgress = localStorage.getItem(`book_${bookId}_progress`);

  if (Math.abs(serverProgress.position - localProgress.position) > 5) {
    // –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
    showConflictDialog(serverProgress, localProgress);
  } else {
    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Å–≤–µ–∂—É—é –ø–æ–∑–∏—Ü–∏—é
    goToPosition(serverProgress.last_read_at > localProgress.savedAt
      ? serverProgress : localProgress);
  }
};
```

**2. –î–∏–∞–ª–æ–≥ –ö–æ–Ω—Ñ–ª–∏–∫—Ç–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –í—ã —á–∏—Ç–∞–ª–∏ —ç—Ç—É –∫–Ω–∏–≥—É –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üì± –î—Ä—É–≥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: –ì–ª–∞–≤–∞ 15, 67%            ‚îÇ
‚îÇ     –ü–æ—Å–ª–µ–¥–Ω–µ–µ —á—Ç–µ–Ω–∏–µ: 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥              ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  üíª –≠—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: –ì–ª–∞–≤–∞ 12, 45%               ‚îÇ
‚îÇ     –ü–æ—Å–ª–µ–¥–Ω–µ–µ —á—Ç–µ–Ω–∏–µ: –≤—á–µ—Ä–∞                     ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  [–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –ì–ª–∞–≤–∞ 15] [–û—Å—Ç–∞—Ç—å—Å—è –Ω–∞ –ì–ª–∞–≤–∞ 12] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4. –ü—Ä–æ–±–ª–µ–º—ã Offline –†–µ–∂–∏–º–∞

### –¢–µ–∫—É—â–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ß—Ç–æ –µ—Å—Ç—å:**
- ‚úÖ IndexedDB –∫—ç—à –≥–ª–∞–≤ (7 –¥–Ω–µ–π TTL)
- ‚úÖ IndexedDB –∫—ç—à –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (100 MB –ª–∏–º–∏—Ç)
- ‚úÖ Prefetch 2 –≥–ª–∞–≤ –≤–ø–µ—Ä—ë–¥, 1 –Ω–∞–∑–∞–¥

**–ß–µ–≥–æ –Ω–µ—Ç:**
- ‚ùå Service Worker –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ offline
- ‚ùå –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ EPUB —Ñ–∞–π–ª–æ–≤
- ‚ùå Offline queue –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á—Ç–µ–Ω–∏—è
- ‚ùå –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–í—ã offline"
- ‚ùå –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å –¥–ª—è offline"

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Kindle

| –§—É–Ω–∫—Ü–∏—è | Kindle | BookReader AI |
|---------|--------|---------------|
| Offline reading | –ü–æ–ª–Ω–æ—Å—Ç—å—é | –ß–∞—Å—Ç–∏—á–Ω–æ (—Ç–æ–ª—å–∫–æ –∫—ç—à) |
| EPUB file caching | –î–∞ (–¥–æ 100 –∫–Ω–∏–≥) | –ù–µ—Ç |
| Sync queue | Background sync | –ù–µ—Ç |
| Offline indicator | –î–∞ | –ù–µ—Ç |
| Download for offline | –î–∞ | –ù–µ—Ç |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**1. –î–æ–±–∞–≤–∏—Ç—å useOnlineStatus hook:**
```typescript
function useOnlineStatus() {
  const [isOnline, setIsOnline] = useState(navigator.onLine);

  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  return isOnline;
}
```

**2. Offline Banner:**
```tsx
{!isOnline && (
  <Banner type="warning">
    üì° –í—ã offline. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏.
  </Banner>
)}
```

**3. IndexedDB queue –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π:**
```typescript
class OfflineQueue {
  async add(operation: { type: 'progress' | 'bookmark', data: any }) {
    // –î–æ–±–∞–≤–∏—Ç—å –≤ IndexedDB
  }

  async processWhenOnline() {
    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏
  }
}
```

---

## 5. –ü—Ä–æ–±–ª–µ–º—ã —Å –û–±—Ä–∞–±–æ—Ç–∫–æ–π –û—à–∏–±–æ–∫

### –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ

**–§–∞–π–ª:** `frontend/src/components/Reader/EpubReader.tsx`
```typescript
{error && (
  <div className="absolute inset-0 flex items-center justify-center">
    <p className="text-red-400 mb-4">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥–∏</p>
    <p className="text-gray-400 text-sm">{error}</p>
    // ‚Üê –ù–µ—Ç –∫–Ω–æ–ø–∫–∏ "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å"!
  </div>
)}
```

### –ü—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ—Ç –∫–Ω–æ–ø–∫–∏ "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å"** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏
2. **–ù–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** ("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥–∏")
3. **–û—à–∏–±–∫–∏ —Å–µ—Å—Å–∏–∏ –º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è** (console.error)
4. **–ù–µ—Ç retry —Å exponential backoff**

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**1. –£–ª—É—á—à–µ–Ω–Ω—ã–π Error UI:**
```tsx
{error && (
  <ErrorOverlay>
    <ErrorIcon />
    <h3>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–Ω–∏–≥—É</h3>
    <p>{getHumanReadableError(error)}</p>
    <Button onClick={retry}>–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</Button>
    <Button variant="secondary" onClick={goToLibrary}>
      –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É
    </Button>
  </ErrorOverlay>
)}
```

**2. Human-readable –æ—à–∏–±–∫–∏:**
```typescript
function getHumanReadableError(error: string): string {
  const errorMap = {
    'Network Error': '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É',
    'Book not found': '–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞',
    'Unauthorized': '–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞',
    'EPUB parse error': '–§–∞–π–ª –∫–Ω–∏–≥–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω',
  };
  return errorMap[error] || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
}
```

**3. Retry —Å exponential backoff:**
```typescript
async function fetchWithRetry(url: string, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fetch(url);
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
    }
  }
}
```

---

## 6. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –ë–æ–ª—å—à–∏—Ö –ö–Ω–∏–≥–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –∫–Ω–∏–≥–∏ 1000+ —Å—Ç—Ä–∞–Ω–∏—Ü:
- Location generation: 5-15 —Å–µ–∫—É–Ω–¥
- UI –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—É—Å—Ç–æ–π —ç–∫—Ä–∞–Ω

**–§–∞–π–ª:** `frontend/src/hooks/epub/useLocationGeneration.ts`
```typescript
await book.locations.generate(1600); // –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**1. Server-side pre-generation:**
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å locations –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –∫–Ω–∏–≥–∏ –Ω–∞ backend
- –•—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –û—Ç–¥–∞–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å metadata –∫–Ω–∏–≥–∏

**2. Progressive loading:**
```typescript
// –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—É—é –≥–ª–∞–≤—É —Å—Ä–∞–∑—É, locations –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–æ–Ω–µ
useEffect(() => {
  // 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—É—é –≥–ª–∞–≤—É
  await loadFirstChapter();

  // 2. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å locations –≤ Web Worker
  const worker = new Worker('locationWorker.js');
  worker.postMessage({ bookData });
  worker.onmessage = (e) => setLocations(e.data.locations);
}, []);
```

**3. Loading indicator:**
```tsx
<LoadingOverlay>
  <Spinner />
  <p>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–Ω–∏–≥–∏... {progress}%</p>
</LoadingOverlay>
```

---

## –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –ê—Å–ø–µ–∫—Ç—ã

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, BookReader AI –∏–º–µ–µ—Ç —Ä—è–¥ —Ö–æ—Ä–æ—à–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:

1. **CFI + Scroll Offset** ‚Äî pixel-perfect –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
2. **Silent token refresh** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
3. **Debounced progress sync** ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –≤ 300 —Ä–∞–∑
4. **IndexedDB –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à** ‚Äî –≥–ª–∞–≤—ã –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
5. **userId –∏–∑–æ–ª—è—Ü–∏—è** ‚Äî –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è
6. **LRU cleanup** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
7. **Keepalive fetch** ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
8. **Touch/Swipe –Ω–∞–≤–∏–≥–∞—Ü–∏—è** ‚Äî —É–¥–æ–±–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
9. **Keyboard navigation** ‚Äî ‚Üê ‚Üí –¥–ª—è –ª–∏—Å—Ç–∞–Ω–∏—è
10. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã/—à—Ä–∏—Ñ—Ç–∞** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage

---

## –§–∞–π–ª—ã –¥–ª—è –ò–∑–º–µ–Ω–µ–Ω–∏—è

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –§–∞–π–ª | –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å |
|-----------|------|--------------|
| P0 | `stores/auth.ts` | –°–æ—Ö—Ä–∞–Ω—è—Ç—å progress –¥–æ clearAllCaches |
| P0 | `hooks/epub/useProgressSync.ts` | –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ beforeunload |
| P0 | `components/Reader/EpubReader.tsx` | –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É Retry |
| P1 | `hooks/useOnlineStatus.ts` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π hook |
| P1 | `components/Reader/OfflineBanner.tsx` | –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç |
| P1 | `services/offlineQueue.ts` | –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å |
| P2 | `api/client.ts` | –î–æ–±–∞–≤–∏—Ç—å exponential backoff |
| P2 | `hooks/epub/useLocationGeneration.ts` | Web Worker |

---

*–û—Ç—á—ë—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –ª—É—á—à–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ (Kindle, Google Play Books, LitRes, Bookmate).*
