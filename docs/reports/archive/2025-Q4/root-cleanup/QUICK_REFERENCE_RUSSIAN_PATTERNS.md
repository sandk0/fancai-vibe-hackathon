# Быстрая справка: Паттерны русских описаний для Multi-NLP

**Версия:** 1.0 | **Дата:** 2025-11-30

---

## Маркеры типов (Top-20 для каждого типа)

### LOCATION (Локации)

**Top-20 ключевых слов:**
```
дом, замок, дворец, город, лес, река, море, гора, холм, храм,
комната, зал, сад, парк, улица, площадь, деревня, озеро, поле, церковь
```

**Top-5 предлогов места:**
```
в, на, под, над, около
```

**Top-5 глаголов:**
```
стоял/стояла, возвышался, находился, располагался, простирался
```

### CHARACTER (Персонажи)

**Top-20 ключевых слов:**
```
лицо, глаза, волосы, рука, человек, девушка, мужчина, юноша, старик,
женщина, князь, одежда, платье, фигура, рост, кожа, нос, губы, походка, осанка
```

**Top-5 глаголов описания:**
```
выглядел/выглядела, казался/казалась, был одет/была одета, носил/носила, имел/имела
```

### ATMOSPHERE (Атмосфера)

**Top-20 ключевых слов:**
```
атмосфера, настроение, туман, свет, тень, тишина, запах, аромат, звук,
мрачный, светлый, темный, холодный, теплый, тревожный, спокойный, таинственный,
пахло, слышалось, чувствовалось
```

---

## Антипаттерны (что фильтровать)

### Диалоги
```
— « » сказал ответил спросил воскликнул
```

### Служебный текст
```
ГЛАВА Глава ЧАСТЬ Часть *** ---
```

### Действия (stop signals)
```
Вдруг Внезапно Затем Потом пошёл побежал схватил крикнул
```

---

## Визуальные маркеры (для качественных описаний)

### Цвета (Top-10)
```
белый, черный, красный, синий, золотой, серебряный, багровый,
алый, изумрудный, лазурный
```

### Размеры (Top-10)
```
огромный, большой, маленький, высокий, низкий, широкий,
узкий, гигантский, крошечный, толстый
```

### Материалы (Top-8)
```
каменный, деревянный, металлический, мраморный, бархатный,
шелковистый, бронзовый, стеклянный
```

---

## Примеры качественных описаний

### LOCATION (F1 ~0.90)
```
"Старый замок возвышался на высоком холме, окруженный густым лесом.
Его величественные башни касались облаков, а мрачные стены хранили
множество тайн."
```
**Ключи:** пространственный глагол + визуальные маркеры + детали + coherence

### CHARACTER (F1 ~0.85)
```
"Молодой князь Алексей стоял у окна, его темные глаза смотрели вдаль.
Длинные черные волосы развевались на ветру."
```
**Ключи:** именованная сущность + внешность + визуальные детали

### ATMOSPHERE (F1 ~0.80)
```
"Атмосфера в зале была торжественной и немного мрачной. Тяжелые портьеры
из темного бархата поглощали звуки, создавая ощущение изолированности."
```
**Ключи:** эмоциональные маркеры + сенсорные детали + ощущения

---

## Оптимальные параметры для парсера

### Длина описаний (Advanced Parser)
```
MIN:       500 символов
OPTIMAL:   1000-2500 символов
MAX:       4000 символов
PRIORITY:  2000-3500 символов (weight 2.5)
```

### Веса процессоров (Production)
```
SpaCy:    1.0
Natasha:  1.2  ← специализация на русском
GLiNER:   1.0
Stanza:   0.8
```

### Пороги качества
```
MIN_CONFIDENCE:         0.65
MIN_WORD_COUNT:         10
MIN_SENTENCE_LENGTH:    30
CONSENSUS_THRESHOLD:    0.6 (60%)
```

---

## Промпт для генерации изображений

### Структура (150-400 символов)
```
[Тип] + [Визуальные маркеры] + [Контекст] + [Атмосфера] + [Стиль]
```

### Пример (LOCATION)
```
"Старинный русский замок на высоком холме, окруженный густым туманным лесом.
Мрачные каменные стены покрыты плющом, величественные башни касаются облаков.
Золотистый закатный свет, таинственная атмосфера.
Стиль: русская романтическая живопись 19 века."
```

**Ключевые элементы:**
- ✅ "Русский" / "российский" (локальный контекст)
- ✅ 3-4 визуальных характеристики
- ✅ Атмосферные детали
- ✅ Художественный стиль
- ✅ Длина: 150-400 символов

---

## Метрики успеха (Production)

```
F1 Score:       0.88-0.90  ✅ Отлично
Precision:      85-90%     ✅ Высокая точность
Recall:         80-85%     ✅ Хороший охват
Speed:          543 desc/sec ✅ Превосходно
Quality:        >70% relevant ✅ KPI выполнен
```

---

## Быстрая диагностика проблем

### Низкий Recall (<80%)
**Причина:** Слишком строгие фильтры
**Решение:** Снизить `min_confidence` с 0.65 до 0.60

### Низкий Precision (<85%)
**Причина:** Много ложных срабатываний (диалоги, действия)
**Решение:** Усилить антипаттерны, повысить `min_word_count`

### Медленная обработка (>5 сек/книга)
**Причина:** Stanza processor слишком медленный
**Решение:** Снизить weight Stanza с 0.8 до 0.6 или отключить

### Мало длинных описаний
**Причина:** Фильтр по max_length слишком строгий
**Решение:** Увеличить `max_char_length` с 4000 до 5000

---

**Полная документация:** `RUSSIAN_DESCRIPTION_PATTERNS_ANALYSIS.md`
