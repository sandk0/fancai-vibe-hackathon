# –û—Ç—á–µ—Ç –ø–æ —Ç–µ—Å—Ç–æ–≤–æ–º—É –ø–æ–∫—Ä—ã—Ç–∏—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ BookReader AI

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 14 –¥–µ–∫–∞–±—Ä—è 2025
**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:** Vitest 0.34.6 + React Testing Library 13.4.0
**–Ø–∑—ã–∫:** React 18 + TypeScript

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞** | 109 | - |
| **–§–∞–π–ª–æ–≤ —Å —Ç–µ—Å—Ç–∞–º–∏** | 6 | 5.5% |
| **–¢–µ—Å—Ç–æ–≤ –Ω–∞–ø–∏—Å–∞–Ω–æ** | 111 (107 pass, 3 fail, 1 skip) | ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ –Ω–∏–∑–∫–æ |
| **–¢–µ—Å—Ç—ã –Ω–µ—É–¥–∞—á–Ω—ã–µ** | 3 | üî¥ BLOCKER |
| **–ü–æ–∫—Ä—ã—Ç–∏–µ** | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ | ‚ö†Ô∏è –ù–µ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è |
| **–¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** | >70% | üî¥ –ù–µ–¥–æ—Å—Ç–∏–≥–∞–µ–º–æ |

---

## 1Ô∏è‚É£ –ù–ï–ü–û–ö–†–´–¢–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´

### –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–µ—Å—Ç—ã (98% —Ñ–∞–π–ª–æ–≤!)

#### Reader Components (11 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤)
- ‚ùå `ReaderSettingsPanel.tsx` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —á—Ç–µ–Ω–∏—è (—à—Ä–∏—Ñ—Ç, —Ç–µ–º–∞, –∏–Ω—Ç–µ—Ä–≤–∞–ª)
- ‚ùå `ReaderControls.tsx` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–µ–µ—Ä–æ–º EPUB
- ‚ùå `SelectionMenu.tsx` - –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º
- ‚ùå `ReaderNavigationControls.tsx` - –∫–Ω–æ–ø–∫–∏ –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥
- ‚ùå `TocSidebar.tsx` - –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ (Table of Contents)
- ‚ùå `BookReader.tsx` - –æ—Å–Ω–æ–≤–Ω–æ–π wrapper
- ‚ùå `ProgressIndicator.tsx` - –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (%)
- ‚ùå `ReaderToolbar.tsx` - —Ç—É–ª–±–∞—Ä —Å –æ–ø—Ü–∏—è–º–∏
- ‚ùå `ReaderContent.tsx` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚ùå `ReaderHeader.tsx` - –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- ‚ùå `ImageGenerationStatus.tsx` - —Å—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å Reader —ç—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–ª–æ–º–∞—é—Ç —Ñ—É–∫–Ω—Ü–∏–æ–Ω–∞–ª üëª

#### UI Components (10 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤)
- ‚ùå `ThemeSwitcher.tsx` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
- ‚ùå `ErrorMessage.tsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- ‚ùå `NotificationContainer.tsx` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚ùå `LoadingSpinner.tsx` - —Å–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- ‚ùå Radix UI primitives (`slider.tsx`, `popover.tsx`, `progress.tsx`, `tooltip.tsx`, `button.tsx`, `dropdown-menu.tsx`, `separator.tsx`)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### Layout Components (3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤)
- ‚ùå `Layout.tsx` - –æ—Å–Ω–æ–≤–Ω–æ–π layout
- ‚ùå `Header.tsx` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚ùå `Sidebar.tsx` - –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –º–∞–∫–µ—Ç –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã, –ª–æ–º–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–µ –≤—ã—è–≤–∏—Ç—Å—è

#### –î—Ä—É–≥–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚ùå `BookUploadModal.tsx` (739 —Å—Ç—Ä–æ–∫) - –æ—Å–Ω–æ–≤–Ω–æ–π workflow –∑–∞–≥—Ä—É–∑–∫–∏
- ‚ùå `ImageGallery.tsx` - –≥–∞–ª–µ—Ä–µ—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚ùå `ImageModal.tsx` - –º–æ–¥–∞–ª —Å –±–æ–ª—å—à–∏–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
- ‚ùå `AuthGuard.tsx` - –∑–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚ùå `ReaderSettings.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚ùå `ParsingOverlay.tsx` - –æ–≤–µ—Ä–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –°–µ—Ä—å–µ–∑–Ω—ã–π –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫: API endpoints

- ‚ùå `auth.ts` (203 —Å—Ç—Ä–æ–∫–∏) - –ü–û–õ–ù–û–°–¢–¨–Æ –ë–ï–ó –¢–ï–°–¢–û–í
- ‚ùå `readingSessions.ts` - —á—Ç–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
- ‚ùå `admin.ts` - –∞–¥–º–∏–Ω API –±–µ–∑ —Ç–µ—Å—Ç–æ–≤
- ‚ùå `images.ts` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ —Ç–µ—Å—Ç–æ–≤
- ‚ùå `client.ts` - HTTP –∫–ª–∏–µ–Ω—Ç –±–µ–∑ —Ç–µ—Å—Ç–æ–≤

**–ò–º–ø–∞–∫—Ç:** –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ª–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å backend!

### –•—É–∫–∏ (27 —Ö—É–∫–æ–≤ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤)

**Reader hooks:**
- ‚ùå `useReaderImageModal.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª–æ–º
- ‚ùå `useReadingProgress.ts` - –ø—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è
- ‚ùå `useChapterNavigation.ts` - –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –≥–ª–∞–≤–∞–º–∏
- ‚ùå `useAutoParser.ts` - –∞–≤—Ç–æ–ø–∞—Ä—Å–µ—Ä
- ‚ùå `usePagination.ts` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- ‚ùå `useDescriptionManagement.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏

**EPUB hooks (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ!):**
- ‚ùå `useEpubLoader.ts` - –∑–∞–≥—Ä—É–∑–∫–∞ EPUB (–ö–†–ò–¢–ò–ß–ù–û)
- ‚ùå `useLocationGeneration.ts` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Å—Ç –≤ –∫–Ω–∏–≥–µ
- ‚ùå `useCFITracking.ts` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (–ö–†–ò–¢–ò–ß–ù–û)
- ‚ùå `useProgressSync.ts` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- ‚ùå `useEpubNavigation.ts` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- ‚ùå `useEpubThemes.ts` - —Ç–µ–º—ã
- ‚ùå `useBookMetadata.ts` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- ‚ùå `useTouchNavigation.ts` - —Å–µ–Ω—Å–æ—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- ‚ùå `useContentHooks.ts` - —Ö—É–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚ùå `useChapterMapping.ts` - –º–∞–ø–ø–∏–Ω–≥ –≥–ª–∞–≤
- ‚ùå `useChapterManagement.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–∞–º–∏
- ‚ùå `useTextSelection.ts` - –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
- ‚ùå `useResizeHandler.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
- ‚ùå `useToc.ts` - –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- ‚ùå `useKeyboardNavigation.ts` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞

**–î—Ä—É–≥–∏–µ —Ö—É–∫–∏:**
- ‚ùå `useTheme.ts` - —Ç–µ–º–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚ùå `useTranslation.ts` - –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
- ‚ùå `useReadingSession.ts` - —Å–µ—Å—Å–∏—è —á—Ç–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–∏ —Ö—É–∫–∏ - —Å–µ—Ä–¥—Ü–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! –ë–µ–∑ —Ç–µ—Å—Ç–æ–≤ –ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ - —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ.

### –°–µ—Ä–≤–∏—Å—ã (–±–µ–∑ —Ç–µ—Å—Ç–æ–≤)

- ‚ùå `imageCache.ts` (482 —Å—Ç—Ä–æ–∫–∏) - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ IndexedDB

---

## 2Ô∏è‚É£ –¢–ï–°–¢–´, –ö–û–¢–û–†–´–ï –ï–°–¢–¨: –ê–ù–ê–õ–ò–ó –ö–ê–ß–ï–°–¢–í–ê

### ‚úÖ –•–æ—Ä–æ—à–∏–µ —Ç–µ—Å—Ç—ã (45%)

**–§–∞–π–ª—ã —Å –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º:**
- `src/stores/__tests__/auth.test.ts` (370 —Å—Ç—Ä–æ–∫, 9 —Ç–µ—Å—Ç–æ–≤) - –•–æ—Ä–æ—à–∏–π
- `src/stores/__tests__/books.test.ts` (420 —Å—Ç—Ä–æ–∫, 18 —Ç–µ—Å—Ç–æ–≤) - –•–æ—Ä–æ—à–∏–π

**–ü–ª—é—Å—ã:**
- ‚úÖ AAA –ø–∞—Ç—Ç–µ—Ä–Ω (Arrange-Act-Assert)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É—é—Ç –∫–∞–∫ happy path, —Ç–∞–∫ –∏ error cases
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç renderHook –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –•–æ—Ä–æ—à–∏–µ –º–æ–∫–∏
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–µ–≥–æ:**
```typescript
// –•–æ—Ä–æ—à–∏–π —Ç–µ—Å—Ç - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∫ —É—Å–ø–µ—Ö, —Ç–∞–∫ –∏ –æ—à–∏–±–∫—É
it('should handle login error', async () => {
  vi.mocked(authAPI.login).mockRejectedValue(new Error('Invalid credentials'));
  // ...
  expect(result.current.isAuthenticated).toBe(false);
  expect(result.current.user).toBeNull();
});
```

### ‚ö†Ô∏è –°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–∞—Ö

#### 1. API Tests - –ø—Ä–æ—Å—Ç—ã–µ URL –æ—à–∏–±–∫–∏ (3 FAILED)

```javascript
// FAIL: –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç '/books', –Ω–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç '/books/'
expect(apiClient.get).toHaveBeenCalledWith('/books');
// –ü–æ–ª—É—á–µ–Ω–æ: '/books/'
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç—ã —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ –∫ –¥–µ—Ç–∞–ª—è–º URL. –ï—Å—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Ç–µ—Å—Ç–æ–º –∏ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –í–ú–ï–°–¢–û
expect(apiClient.get).toHaveBeenCalledWith('/books');
// –õ–£–ß–®–ï
expect(apiClient.get).toHaveBeenCalledWith(expect.stringContaining('books'));
```

#### 2. Reader Component Tests - false positives

```typescript
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –¢–µ—Å—Ç –∏—â–µ—Ç —Ç–µ–∫—Å—Ç '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥–∏...'
// –Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏–ª '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏...'
// –¢–µ—Å—Ç FAIL, –Ω–æ —ç—Ç–æ –Ω–µ –±–∞–≥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ - —ç—Ç–æ –±–∞–≥ —Ç–µ—Å—Ç–∞!

await waitFor(() => {
  expect(screen.getByText('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥–∏...')).toBeInTheDocument();
});
// –ü–æ–ª—É—á–µ–Ω–æ: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏...'
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç—ã –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ. –≠—Ç–æ –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –í–ú–ï–°–¢–û —Ç–æ—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
expect(screen.getByText('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥–∏...'))
// –õ–£–ß–®–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å regex
expect(screen.getByText(/–∑–∞–≥—Ä—É–∑–∫–∞|–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ/i))
```

#### 3. LibraryPage Tests - —Ç–æ–ª—å–∫–æ happy path

```typescript
// –¢–û–õ–¨–ö–û happy path: –µ—Å—Ç—å –∫–Ω–∏–≥–∏ ‚úÖ
it('renders books list with books', ...)

// HAPPY PATH: –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ø–µ—à–Ω–∞ ‚úÖ
it('opens upload modal on button click', ...)

// –ù–û –ù–ï–õ–¨–ó–Ø –ù–ê–ô–¢–ò:
// ‚ùå –ß—Ç–æ –µ—Å–ª–∏ API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ?
// ‚ùå –ß—Ç–æ –µ—Å–ª–∏ –∫–Ω–∏–≥–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å?
// ‚ùå –ß—Ç–æ –µ—Å–ª–∏ —Å–µ—Ç—å —É–ø–∞–ª–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏?
// ‚ùå –ß—Ç–æ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∑–∞–≤–∏—Å–Ω–µ—Ç?
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ —Ç–µ—Å—Ç—ã - —ç—Ç–æ "–∏–¥–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π". –ù–µ—Ç stress testing.

#### 4. Mock Problems - —Å–ª–∏—à–∫–æ–º –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –º–æ–∫–∏

```typescript
vi.mock('@/stores/books', () => ({
  useBooksStore: vi.fn(() => ({
    books: [],
    // –≠—Ç–æ –ú–û–ö–ê - –Ω–µ —Å–≤—è–∑–∞–Ω–∞ —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π!
    // –ï—Å–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π store –∏–∑–º–µ–Ω–∏—Ç—Å—è, —Ç–µ—Å—Ç –Ω–µ —É–∑–Ω–∞–µ—Ç!
  })),
}));
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ú–æ–∫–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º
- –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å store –∏–∑–º–µ–Ω–∏—Ç—Å—è, —Ç–µ—Å—Ç—ã —ç—Ç–æ –Ω–µ –ø–æ–π–º—É—Ç
- False positives: —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ—Ç, –Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ª–æ–º–∞–µ—Ç—Å—è –≤ –±–æ–µ–≤–æ–º –∫–æ–¥–µ

#### 5. EpubReader Tests - –º–µ–≥–∞—Ç–µ—Å—Ç—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é

```typescript
// –û–¥–∏–Ω —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¢–†–ò —Ä–∞–∑–Ω—ã—Ö –≤–µ—â–∏ —Å—Ä–∞–∑—É
it('renders with valid book data', async () => {
  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–Ω–¥–µ—Ä
  // 2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∫–Ω–∏–≥–∏
  // 3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —ç–ø—É–±–∞
  // = –°–õ–ò–®–ö–û–ú –ú–ù–û–ì–û –í –û–î–ù–û–ú –¢–ï–°–¢–ï
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Single Responsibility Principle –Ω–∞—Ä—É—à–µ–Ω. –ï—Å–ª–∏ –æ–¥–Ω–∞ —á–∞—Å—Ç—å —Å–ª–æ–º–∞–µ—Ç—Å—è, –Ω–µ—è—Å–Ω–æ, –∫–∞–∫–∞—è –∏–º–µ–Ω–Ω–æ.

#### 6. Skip –∏ TODO —Ç–µ—Å—Ç—ã

```typescript
it.skip('respects dark theme from localStorage', () => {
  // –ü—Ä–æ–ø—É—â–µ–Ω - –∑–Ω–∞—á–∏—Ç –Ω–µ –≤–∞–∂–µ–Ω?
  // –ù–æ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π bug!
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã = –∑–∞–±—ã—Ç—ã–µ –±–∞–≥–∏

---

## 3Ô∏è‚É£ –û–¢–°–£–¢–°–¢–í–ò–ï –ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–• –¢–ï–°–¢–û–í

### –ù–µ—Ç E2E scenarios

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫—Ç–æ –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:**

1. **Upload ‚Üí Parse ‚Üí Read flow**
   ```
   –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–Ω–∏–≥—É ‚Üí –î–æ–∂–¥–∞—Ç—å—Å—è –ø–∞—Ä—Å–∏–Ω–≥–∞ ‚Üí –û—Ç–∫—Ä—ã—Ç—å –¥–ª—è —á—Ç–µ–Ω–∏—è
   –®–∞–≥ 1: –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ‚úó (–Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)
   –®–∞–≥ 2: –ü–∞—Ä—Å–∏–Ω–≥ (–æ–ø–∏—Å–∞–Ω–∏—è) ‚úó (–Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)
   –®–∞–≥ 3: –ß—Ç–µ–Ω–∏–µ = 35 —Ç–µ—Å—Ç–æ–≤ (–º–Ω–æ–≥–æ –º–æ–∫–æ–≤)
   ```

2. **Reading Progress Persistence**
   ```
   –û—Ç–∫—Ä—ã—Ç—å –∫–Ω–∏–≥—É ‚Üí –ü—Ä–æ—á–∏—Ç–∞—Ç—å 50 —Å—Ç—Ä–∞–Ω–∏—Ü ‚Üí –ó–∞–∫—Ä—ã—Ç—å ‚Üí –û—Ç–∫—Ä—ã—Ç—å —Å–Ω–æ–≤–∞ ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é
   –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É:
   - useProgressSync
   - updateReadingProgress API
   - CFI –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
   ```

3. **Image Generation**
   ```
   –ö–ª–∏–∫ –Ω–∞ –æ–ø–∏—Å–∞–Ω–∏–µ ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–æ–¥–∞–ª–µ
   –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–∑–≤—è–∑–∞–Ω—ã, –Ω–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
   ```

4. **Authentication Flow**
   ```
   –õ–æ–≥–∏–Ω ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ ‚Üí –ó–∞–ø—Ä–æ—Å —Å Authorization ‚Üí Logoff
   auth API —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ store (–º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   ```

5. **Offline Mode**
   ```
   imageCache.ts = 482 —Å—Ç—Ä–æ–∫–∏, –ü–û–õ–ù–û–°–¢–¨–Æ –ë–ï–ó –¢–ï–°–¢–û–í
   –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–µ—à–∏—Ä—É—é—Ç—Å—è –≤ IndexedDB?
   –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–Ω–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –∫–µ—à–∞ –æ—Ñ—Ñ–ª–∞–π–Ω?
   ```

### –ß—Ç–æ –Ω—É–∂–Ω–æ: Integration Tests

```typescript
// ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
describe('Reading Session Integration', () => {
  it('saves and restores reading position with CFI', async () => {
    // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–Ω–∏–≥—É
    // 2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É 50
    // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ API
    // 4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    // 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
    // –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç–æ—è—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –Ω–µ –º–æ–∫–æ–≤!
  });
});
```

---

## 4Ô∏è‚É£ –ü–†–û–ë–õ–ï–ú–´ –° –ú–û–ö–ê–ú–ò

### –ú–æ–∫–∞ 1: –†–∞–∑—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –º–æ–∫–∏ —Ä–∞–∑–Ω—ã—Ö —Å–ª–æ–µ–≤

```typescript
// –í auth.test.ts –º–æ–∫–∏ —Å—Ç—Ä–æ–≥–æ:
vi.mock('@/api/auth', () => ({
  authAPI: {
    login: vi.fn(),
    register: vi.fn(),
  },
}));

// –ê –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
// –¢–µ—Å—Ç—ã –Ω–µ —É–∑–Ω–∞—é—Ç –æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏!
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ API ‚Üí store —Ç–µ—Å—Ç—ã pass ‚Üí –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ª–æ–º–∞–µ—Ç—Å—è –≤ –±–æ–µ–≤–æ–º –∫–æ–¥–µ

### –ú–æ–∫–∞ 2: –ß—Ä–µ–∑–º–µ—Ä–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ EPUB —Ö—É–∫–∏

```typescript
vi.mock('@/hooks/epub', () => ({
  useEpubLoader: vi.fn(() => ({
    book: mockBook,        // –ü–æ–ª–Ω–æ—Å—Ç—å—é –º–æ–∫–∏—Ä–æ–≤–∞–Ω
    rendition: mockRendition, // –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É
    isLoading: false,      // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ true –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏
    error: null,           // –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏
  })),
}));

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
// ‚ùå –í production EPUB –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è - —Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ —É–∑–Ω–∞–ª–∏!
```

### –ú–æ–∫–∞ 3: –ù–µ –º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã —Å–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏

```typescript
// –ì–¥–µ —Ç–µ—Å—Ç –¥–ª—è:
// ‚úó Corrupt EPUB —Ñ–∞–π–ª
// ‚úó Network timeout
// ‚úó Invalid CFI
// ‚úó Missing metadata
// ‚úó Very large file

// –û—Ç–≤–µ—Ç: –∏—Ö –Ω–µ—Ç –≤ 35 —Ç–µ—Å—Ç–∞—Ö EpubReader!
```

---

## 5Ô∏è‚É£ –õ–û–ñ–ù–´–ï –°–†–ê–ë–ê–¢–´–í–ê–ù–ò–Ø –ò –ù–ï–°–¢–ê–ë–ò–õ–¨–ù–´–ï –¢–ï–°–¢–´

### Test 1: URL —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (flaky)

```
FAIL: should fetch books without params
Expected: '/books'
Received: '/books/'
```

**–ü—Ä–∏—á–∏–Ω–∞:** API endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç trailing slash, —Ç–µ—Å—Ç —ç—Ç–æ–≥–æ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:** Normalize URLs –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å flexible matching

### Test 2: Text matching (flaky)

```
FAIL: shows loading state initially
Expected: '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥–∏...'
Received: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏...'
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–∞–∑–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö, —Ç–µ—Å—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pattern matching –∏–ª–∏ data-testid –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞

### Test 3: Race conditions

```typescript
// –ß—Ç–æ –µ—Å–ª–∏:
// - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–Ω–∏–≥—É
// - –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä
// - API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–µ –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ?

// –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —ç—Ç–∏ race conditions!
```

### Test 4: localStorage timing

```typescript
// SKIP —Ç–µ—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:
it.skip('respects dark theme from localStorage', () => {
  // "–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –Ω–æ –≤ —Ç–µ—Å—Ç–∞—Ö –Ω–µ—Ç"
  // = localStorage –º–æ–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
});
```

---

## 6Ô∏è‚É£ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ü–£–°–ö–ò

### Accessibility Testing

```typescript
// ‚ùå –ù–ï–¢ —Ç–µ—Å—Ç–æ–≤ –Ω–∞:
// - ARIA labels
// - Keyboard navigation
// - Screen reader compatibility
// - Color contrast
// - Focus management
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ a11y —Ç–µ—Å—Ç–æ–≤:**
- ReaderControls (–∫–Ω–æ–ø–∫–∏)
- SelectionMenu (–º–µ–Ω—é)
- BookUploadModal (—Ñ–æ—Ä–º–∞)
- ImageModal (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)

### Performance Testing

```typescript
// ‚ùå –ù–ï–¢ —Ç–µ—Å—Ç–æ–≤ –Ω–∞:
// - Render time –±–æ–ª—å—à–µ 100ms
// - –ü–∞–º—è—Ç–∏ leak –≤ EPUB loader
// - Re-renders –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
// - Bundle size
```

### Error Boundaries

```typescript
// ‚úÖ ErrorBoundary.test.tsx –µ—Å—Ç—å (—Ö–æ—Ä–æ—à–æ!)
// ‚ùå –ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Demo, –Ω–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
// ‚ùå –ß—Ç–æ –µ—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ Reader –≤—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É?
```

### Localization (i18n)

```typescript
// ‚ùå useTranslation.ts –ë–ï–ó –¢–ï–°–¢–û–í
// –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
// - –ü–µ—Ä–µ–≤–æ–¥—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
// - –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —è–∑—ã–∫–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
// - Fallback —è–∑—ã–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
```

---

## üìä –ü–†–û–ë–õ–ï–ú–ê –ü–û–ö–†–´–¢–ò–Ø: –¶–ò–§–†–´

### –†–∞—Å—á–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è

```
–§–∞–π–ª—ã —Å —Ç–µ—Å—Ç–∞–º–∏:     6
–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:        109
Coverage ratio:      5.5%

–°—Ç—Ä–æ–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö:     ~3000
–°—Ç—Ä–æ–∫–∏ –≤ –∫–æ–¥–µ:       ~15000+
Line coverage:       <20% (–æ—Ü–µ–Ω–∫–∞)
```

### –ü–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤

| –¢–∏–ø | –í—Å–µ–≥–æ | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ | –ü–æ–∫—Ä—ã—Ç–∏–µ |
|-----|-------|-------------|----------|
| Components | 34 | 2 (EpubReader, ErrorBoundary) | 6% |
| Hooks | 27 | 0 | 0% |
| API | 8 | 1 (books) | 12% |
| Services | 1 | 0 | 0% |
| Stores | 2 | 2 | 100% |
| **–ò–¢–û–ì–û** | **109** | **6** | **5.5%** |

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (BLOCKERS)

### 1. –ù–µ–ø–æ–∫—Ä—ã—Ç—ã–µ User Flows

```
Scenario: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–Ω–∏–≥—É
‚îú‚îÄ BookUploadModal (‚ùå –ë–ï–ó –¢–ï–°–¢–ê)
‚îÇ  ‚îî‚îÄ FileInput + validation (‚ùå –ë–ï–ó –¢–ï–°–¢–ê)
‚îú‚îÄ booksAPI.uploadBook (‚ö†Ô∏è —á–∞—Å—Ç–∏—á–Ω–æ - —Ç–æ–ª—å–∫–æ mock)
‚îî‚îÄ Parsing feedback (‚ùå ParsingOverlay –ë–ï–ó –¢–ï–°–¢–ê)

–†–µ–∑—É–ª—å—Ç–∞—Ç: –õ—é–±–∞—è –ª–æ–º–∫–∞ –≤ upload - –≤—ã—è—Å–Ω–∏—Ç—Å—è –≤ production!
```

### 2. Reader –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –º–æ–∫–æ–≤

```
EpubReader test file:
- 35 —Ç–µ—Å—Ç–æ–≤
- 20 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö vi.mock()
- –ù–∏ –æ–¥–∏–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π epub.js

–ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ EPUB –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ:
1. –ù—É–∂–Ω—ã integration —Ç–µ—Å—Ç—ã —Å –Ω–∞—Å—Ç–æ—è—â–∏–º —Ñ–∞–π–ª–æ–º
2. –ù—É–∂–Ω—ã E2E —Ç–µ—Å—Ç—ã —Å playwright
3. –°–µ–π—á–∞—Å: –Ω–∏–∫–∞–∫–∏—Ö
```

### 3. API layer –Ω–µ –∑–∞—â–∏—â–µ–Ω

```
auth.ts (203 —Å—Ç—Ä–æ–∫–∏) - 0 –¢–ï–°–¢–û–í
‚îú‚îÄ login - –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
‚îú‚îÄ register - –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
‚îú‚îÄ logout - –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
‚îî‚îÄ refresh token - –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

–†–µ–∑—É–ª—å—Ç–∞—Ç: auth errors –¥–æ—Å—Ç–∏–≥–∞—é—Ç production
```

### 4. –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–µ–ª–∞—é—Ç CI/CD –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º

```
Current state:
‚úì 107 pass
‚úó 3 fail (flaky)
‚äò 1 skip

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ:
- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç —Ç–µ—Å—Ç—ã
- CI/CD –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–ª–æ—Ö–æ–π –∫–æ–¥
- Quality gates –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
```

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ

### Priority 1: CRITICAL (–Ω–µ–¥–µ–ª—è 1-2)

**1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (3 FAIL)**
   - [ ] Normalize URL matching –≤ books.test.ts
   - [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å text matching –≤ EpubReader.test.ts
   - Effort: 1 —á–∞—Å

**2. –î–æ–±–∞–≤–∏—Ç—å API —Ç–µ—Å—Ç—ã**
   - [ ] auth.test.ts (203 —Å—Ç—Ä–æ–∫ code)
   - [ ] images.test.ts
   - [ ] client.test.ts (HTTP interceptors)
   - Effort: 4 —á–∞—Å–∞ | Expected: 15+ tests

**3. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è Reader**
   - [ ] –ó–∞–≥—Ä—É–∑–∫–∞ EPUB —Å validation
   - [ ] CFI tracking –∏ restore
   - [ ] Progress sync —Å API
   - Effort: 6 —á–∞—Å–æ–≤ | Expected: 10+ tests

### Priority 2: HIGH (–Ω–µ–¥–µ–ª—è 3-4)

**4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ö—É–∫–∏**
   - [ ] useCFITracking.ts (CRITICAL!)
   - [ ] useEpubLoader.ts (CRITICAL!)
   - [ ] useProgressSync.ts (CRITICAL!)
   - [ ] useDescriptionHighlighting.ts
   - Effort: 8 —á–∞—Å–æ–≤ | Expected: 25+ tests

**5. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–µ—Å—Ç—ã**
   - [ ] BookUploadModal.tsx (739 —Å—Ç—Ä–æ–∫!)
   - [ ] ReaderHeader.tsx
   - [ ] ReaderControls.tsx
   - [ ] TocSidebar.tsx
   - [ ] ImageModal.tsx
   - Effort: 8 —á–∞—Å–æ–≤ | Expected: 30+ tests

**6. –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å —Ç–µ—Å—Ç—ã**
   - [ ] imageCache.ts (IndexedDB mocking)
   - Effort: 3 —á–∞—Å–∞ | Expected: 8+ tests

### Priority 3: MEDIUM (–Ω–µ–¥–µ–ª—è 5-6)

**7. –î–æ–±–∞–≤–∏—Ç—å accessibility —Ç–µ—Å—Ç—ã**
   - [ ] Keyboard navigation
   - [ ] ARIA labels
   - [ ] Screen reader
   - Effort: 6 —á–∞—Å–æ–≤ | Expected: 15+ tests

**8. –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã (Playwright)**
   - [ ] Auth flow (login ‚Üí logout)
   - [ ] Upload ‚Üí Read flow
   - [ ] Offline caching
   - Effort: 8 —á–∞—Å–æ–≤ | Expected: 5+ scenarios

---

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –ù–µ–¥–µ–ª—è 1: Stabilization (5 —á–∞—Å–æ–≤)
```bash
# 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å flaky —Ç–µ—Å—Ç—ã
npm test -- --reporter=verbose

# –ù–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
# ‚ùå books.test.ts URL assertions
# ‚ùå EpubReader.test.ts text matching
```

### –ù–µ–¥–µ–ª—è 2-3: Coverage (20 —á–∞—Å–æ–≤)
```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å auth API —Ç–µ—Å—Ç—ã
touch frontend/src/api/__tests__/auth.test.ts

# 2. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
touch frontend/src/components/Reader/__tests__/Reader.integration.test.tsx

# 3. –î–æ–±–∞–≤–∏—Ç—å hooks —Ç–µ—Å—Ç—ã
touch frontend/src/hooks/__tests__/useCFITracking.test.ts
touch frontend/src/hooks/__tests__/useEpubLoader.test.ts
```

### –ù–µ–¥–µ–ª—è 4-5: Component Coverage (15 —á–∞—Å–æ–≤)
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
touch frontend/src/components/Books/__tests__/BookUploadModal.test.tsx
touch frontend/src/components/Reader/__tests__/ReaderControls.test.tsx
# ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
```

### –ù–µ–¥–µ–ª—è 6: Accessibility & E2E (15 —á–∞—Å–æ–≤)
```bash
# Accessibility –≤ vitest
touch frontend/src/__tests__/accessibility.test.ts

# E2E –≤ playwright
touch tests/e2e/auth.spec.ts
touch tests/e2e/reading.spec.ts
```

---

## ‚úÖ SUCCESS CRITERIA

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ |
|---------|---------|---------|
| **–§–∞–π–ª—ã —Å —Ç–µ—Å—Ç–∞–º–∏** | 6 (5.5%) | 30+ (25%) |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤** | 111 | 250+ |
| **–ü–æ–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–æ–∫** | <20% | >70% |
| **Flaky —Ç–µ—Å—Ç—ã** | 3 ‚ùå | 0 ‚úÖ |
| **Integration tests** | 0 ‚ùå | 10+ ‚úÖ |
| **API coverage** | 12% ‚ö†Ô∏è | 80%+ ‚úÖ |
| **Component coverage** | 6% ‚ö†Ô∏è | 70%+ ‚úÖ |
| **Hook coverage** | 0% ‚ùå | 60%+ ‚úÖ |

---

## üìö BEST PRACTICES –î–õ–Ø –§–†–û–ù–¢–ï–ù–î–ê

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```typescript
// ‚úÖ –•–û–†–û–®–û
describe('ComponentName', () => {
  describe('Feature A', () => {
    it('should do X when Y', () => { ... });
    it('should handle error when Z', () => { ... });
  });

  describe('Feature B', () => {
    it('should do X when Y', () => { ... });
  });
});

// ‚ùå –ü–õ–û–•–û
describe('ComponentName', () => {
  it('should work', () => { ... });
  it('should also work', () => { ... });
});
```

### 2. –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
// ‚úÖ –•–û–†–û–®–û: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –º–æ–∫–∏, –º–∞–∫—Å–∏–º—É–º —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏
vi.mock('@/api/books', () => ({
  booksAPI: {
    getBook: vi.fn(),
  },
}));

// ‚ùå –ü–õ–û–•–û: –ß—Ä–µ–∑–º–µ—Ä–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
vi.mock('@/hooks/epub', () => ({
  useEpubLoader: vi.fn(() => ({ ... })), // –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
}));
```

### 3. Testing Library rules

```typescript
// ‚úÖ –•–û–†–û–®–û: Query –ø–æ semantics
getByRole('button', { name: /submit/i })
getByLabelText(/email/i)

// ‚ùå –ü–õ–û–•–û: Query –ø–æ –¥–µ—Ç–∞–ª—è–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
getByTestId('form-btn')
getByClassName('btn-primary')
```

### 4. Error handling

```typescript
// ‚úÖ –•–û–†–û–®–û: –¢–µ—Å—Ç–∏—Ä—É–µ–º error cases
it('should show error message on failure', () => {
  vi.mocked(api).mockRejectedValue(new Error('Network error'));
  // ...
  expect(screen.getByText(/error/i)).toBeInTheDocument();
});

// ‚ùå –ü–õ–û–•–û: –¢–æ–ª—å–∫–æ happy path
it('should fetch data', () => {
  vi.mocked(api).mockResolvedValue(data);
  // ...
});
```

---

## üéØ –í–´–í–û–î–´

### –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **–ö—Ä–∞–π–Ω–µ –Ω–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** - 5.5% —Ñ–∞–π–ª–æ–≤ —Å —Ç–µ—Å—Ç–∞–º–∏
2. **3 –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞** - CI/CD –Ω–µ –Ω–∞–¥–µ–∂–µ–Ω
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** - User flows –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã
4. **–ù–µ–ø–æ–∫—Ä—ã—Ç—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
   - BookUploadModal (–æ—Å–Ω–æ–≤–Ω–æ–π workflow)
   - Reader –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (11 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
   - API —Å–ª–æ–π (auth, images)
   - EPUB —Ö—É–∫–∏ (27 —Ö—É–∫–æ–≤)

**–†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏:** –û–ß–ï–ù–¨ –í–´–°–û–ö–ò–ô

–õ—é–±–æ–π refactor ‚Üí –º–Ω–æ–≥–æ surprises –≤ production.

### –ü—É—Ç—å –≤–ø–µ—Ä–µ–¥

1. **–ù–µ–¥–µ–ª—è 1:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å 3 flaky —Ç–µ—Å—Ç–∞ (quick win)
2. **–ù–µ–¥–µ–ª–∏ 2-5:** –î–æ–±–∞–≤–∏—Ç—å 140+ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π
3. **–ù–µ–¥–µ–ª—è 6+:** E2E —Ç–µ—Å—Ç—ã –∏ accessibility

**–≠—Ñ—Ñ–µ–∫—Ç:** Coverage > 70% ‚Üí Confidence > 90% ‚Üí Production –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª–µ–Ω

---

**–ê–≤—Ç–æ—Ä –æ—Ç—á–µ—Ç–∞:** QA Specialist Agent
**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** Vitest, React Testing Library
**–î–∞—Ç–∞:** 14 –¥–µ–∫–∞–±—Ä—è 2025
