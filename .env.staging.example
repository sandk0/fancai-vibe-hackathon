# BookReader AI - Staging Environment Variables
# Optimized for 4GB RAM / 2 CPU cores server
#
# ⚠️  IMPORTANT SECURITY NOTICE ⚠️
# - Copy this file to .env.staging for staging deployment
# - Generate strong secrets (see commands below)
# - Never commit .env.staging to git!

# =============================================================================
# ENVIRONMENT
# =============================================================================
ENVIRONMENT=staging
DEBUG=false  # Always false in staging!

# =============================================================================
# DOMAIN CONFIGURATION
# =============================================================================
DOMAIN_NAME=staging.yourdomain.com
DOMAIN_URL=https://staging.yourdomain.com
SSL_EMAIL=admin@yourdomain.com

# =============================================================================
# DATABASE SETTINGS
# =============================================================================
DB_NAME=bookreader_staging
DB_USER=postgres
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
DB_PASSWORD=REPLACE_WITH_GENERATED_SECRET_MIN_32_CHARS

DATABASE_URL=postgresql+asyncpg://${DB_USER}:${DB_PASSWORD}@postgres:5432/${DB_NAME}

# =============================================================================
# REDIS SETTINGS
# =============================================================================
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
REDIS_PASSWORD=REPLACE_WITH_GENERATED_SECRET_MIN_32_CHARS
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379

# =============================================================================
# SECURITY SECRETS (CRITICAL!)
# =============================================================================
# Generate using: python -c "import secrets; print(secrets.token_urlsafe(64))"
SECRET_KEY=REPLACE_WITH_GENERATED_SECRET_MIN_64_CHARS
JWT_SECRET_KEY=REPLACE_WITH_GENERATED_SECRET_MIN_64_CHARS
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# =============================================================================
# AI SERVICES
# =============================================================================
OPENAI_API_KEY=  # Optional - for testing DALL-E
POLLINATIONS_ENABLED=true

# =============================================================================
# PERFORMANCE TUNING FOR 4GB RAM SERVER
# =============================================================================
# Backend workers (reduced for staging)
WORKERS_COUNT=2  # Production: 4

# Celery worker configuration
CELERY_CONCURRENCY=1  # Single worker thread
CELERY_MAX_TASKS_PER_CHILD=50  # Restart after 50 tasks
CELERY_WORKER_MAX_MEMORY_PER_CHILD=800000  # 800MB in KB

# Broker and result backend
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/1
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@redis:6379/2

# Logging (reduced verbosity to save CPU)
LOG_LEVEL=warning  # production: info, staging: warning

# =============================================================================
# MULTI-NLP CONFIGURATION (October 2025)
# =============================================================================
# Recommended for staging: single or parallel (faster, less memory)
MULTI_NLP_MODE=parallel  # Production uses 'ensemble'

# Consensus threshold (if using ensemble mode)
CONSENSUS_THRESHOLD=0.6

# Processor weights
SPACY_WEIGHT=1.0
NATASHA_WEIGHT=1.2
STANZA_WEIGHT=0.8

# Individual thresholds
SPACY_THRESHOLD=0.3
NATASHA_THRESHOLD=0.25
STANZA_THRESHOLD=0.35

# =============================================================================
# CFI (Canonical Fragment Identifier) CONFIGURATION
# =============================================================================
CFI_MAX_LENGTH=500
CFI_VALIDATION_ENABLED=true
CFI_MODE=auto

# =============================================================================
# SECURITY & CORS
# =============================================================================
CORS_ORIGINS=https://staging.yourdomain.com
ALLOWED_HOSTS=staging.yourdomain.com,localhost,127.0.0.1

# =============================================================================
# MONITORING (DISABLED FOR STAGING TO SAVE MEMORY)
# =============================================================================
# Prometheus/Grafana disabled on 4GB server
# Use docker-compose.production.yml on larger servers for monitoring
PROMETHEUS_ENABLED=false
GRAFANA_ENABLED=false

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================
BACKUP_ENABLED=true
BACKUP_RETENTION_DAYS=3  # Shorter retention for staging
BACKUP_S3_BUCKET=
BACKUP_S3_ACCESS_KEY=
BACKUP_S3_SECRET_KEY=

# =============================================================================
# STAGING-SPECIFIC NOTES
# =============================================================================
#
# Memory Budget (4GB total):
# - System overhead: ~500MB
# - PostgreSQL: 384-768MB
# - Redis: 192-384MB
# - Backend: 768MB-1.5GB (NLP models)
# - Celery: 512MB-1GB
# - Frontend: 128-256MB
# - Nginx: 64-128MB
# Total: ~3.5GB (safe margin)
#
# CPU Budget (2 cores):
# - Backend: 1.0 core
# - Celery: 0.8 core
# - PostgreSQL: 0.8 core
# - Redis: 0.4 core
# - Other: 0.3 core total
#
# Differences from Production:
# - Reduced worker count (2 vs 4)
# - Single celery concurrency (1 vs 2)
# - Less verbose logging (warning vs info)
# - Smaller PostgreSQL buffers
# - Smaller Redis maxmemory
# - Monitoring stack disabled
# - Watchtower disabled (manual updates)
