# Logrotate configuration for BookReader AI

# Global settings
daily
rotate 7
compress
delaycompress
missingok
notifempty
create 644 root root

# Application logs
/logs/backend/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    postrotate
        # Send SIGUSR1 to Gunicorn to reopen log files
        /usr/bin/docker exec bookreader_backend kill -USR1 1 2>/dev/null || true
    endscript
}

/logs/celery/*.log {
    daily
    rotate 10
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    postrotate
        /usr/bin/docker restart bookreader_celery 2>/dev/null || true
    endscript
}

/logs/nginx/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 nginx nginx
    postrotate
        /usr/bin/docker exec bookreader_nginx nginx -s reopen 2>/dev/null || true
    endscript
}

/logs/postgres/*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 644 postgres postgres
}

/logs/redis/*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 644 redis redis
}