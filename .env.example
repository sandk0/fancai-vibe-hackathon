# BookReader AI Environment Variables
#
# ⚠️  IMPORTANT SECURITY NOTICE ⚠️
# - Never commit this file with real values to git!
# - Copy this file to .env.development for development
# - Copy this file to .env.production for production (with strong secrets!)
# - Ensure .env.* files are in .gitignore
#
# Generate strong secrets using:
# python -c "import secrets; print(secrets.token_urlsafe(64))"

# =============================================================================
# ENVIRONMENT
# =============================================================================
ENVIRONMENT=development  # development, staging, production
DEBUG=true  # Set to false in production!

# =============================================================================
# DOMAIN CONFIGURATION
# =============================================================================
DOMAIN_NAME=localhost
DOMAIN_URL=http://localhost
SSL_EMAIL=admin@yourdomain.com

# =============================================================================
# DATABASE SETTINGS
# =============================================================================
# Development defaults
DB_NAME=bookreader_dev
DB_USER=postgres
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
DB_PASSWORD=REPLACE_WITH_GENERATED_SECRET_MIN_32_CHARS

# Full database URL (constructed from above)
DATABASE_URL=postgresql+asyncpg://${DB_USER}:${DB_PASSWORD}@postgres:5432/${DB_NAME}

# Connection pool configuration (configured in backend/app/core/database.py)
# pool_size=10 (baseline connections)
# max_overflow=20 (burst capacity)
# Total capacity: 30 concurrent database operations

# =============================================================================
# REDIS SETTINGS
# =============================================================================
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
REDIS_PASSWORD=REPLACE_WITH_GENERATED_SECRET_MIN_32_CHARS
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379

# =============================================================================
# SECURITY SECRETS (CRITICAL!)
# =============================================================================
# Generate using: python -c "import secrets; print(secrets.token_urlsafe(64))"
SECRET_KEY=REPLACE_WITH_GENERATED_SECRET_MIN_64_CHARS
JWT_SECRET_KEY=REPLACE_WITH_GENERATED_SECRET_MIN_64_CHARS
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# =============================================================================
# AI SERVICES
# =============================================================================
# OpenAI (optional - for DALL-E image generation)
OPENAI_API_KEY=

# Pollinations.ai (free service)
POLLINATIONS_ENABLED=true

# =============================================================================
# MULTI-NLP CONFIGURATION (October 2025)
# =============================================================================
# Advanced multi-processor NLP system with 3 processors:
# - SpaCy (ru_core_news_lg) - entity recognition, weight 1.0
# - Natasha - Russian morphology and NER, weight 1.2 (specialized)
# - Stanza (ru) - dependency parsing, weight 0.8

# Processing mode selection:
# - single: Use one processor (fastest, lower coverage)
# - parallel: Run all processors in parallel (max coverage, fast)
# - sequential: Run processors one by one (slower, guaranteed order)
# - ensemble: Voting with consensus algorithm (highest quality, slower)
# - adaptive: Auto-select mode based on text complexity (intelligent, recommended)
MULTI_NLP_MODE=ensemble

# Ensemble voting consensus threshold (0.0-1.0)
# 0.6 means 60% of processors must agree for entity to be included
CONSENSUS_THRESHOLD=0.6

# Processor weights for ensemble voting
# Higher weight = more influence in consensus decisions
SPACY_WEIGHT=1.0      # General-purpose entity recognition
NATASHA_WEIGHT=1.2    # Specialized for Russian names/locations
STANZA_WEIGHT=0.8     # Dependency parsing and complex structures

# Individual processor thresholds (0.0-1.0)
# Minimum confidence score for entity to be considered
SPACY_THRESHOLD=0.3
NATASHA_THRESHOLD=0.25
STANZA_THRESHOLD=0.35

# =============================================================================
# CFI (Canonical Fragment Identifier) CONFIGURATION (October 2025)
# =============================================================================
# CFI is EPUB 3.0 standard for precise location addressing in ebooks
# Used for reading progress tracking and navigation

# Maximum CFI string length (characters)
# Typical CFI: "epubcfi(/6/14[chap05ref]!/4[body01]/10/2/1:3[2;is])"
CFI_MAX_LENGTH=500

# Enable strict CFI validation
# When true, validates CFI format according to EPUB 3.0 spec
CFI_VALIDATION_ENABLED=true

# CFI generation mode:
# - auto: Automatically generate CFI on page changes (recommended)
# - manual: Only generate CFI on explicit request
# - disabled: Disable CFI generation (fallback to page numbers)
CFI_MODE=auto

# =============================================================================
# CELERY WORKER CONFIGURATION
# =============================================================================
# Memory optimization settings
CELERY_CONCURRENCY=2  # Tasks per worker
CELERY_MAX_TASKS_PER_CHILD=10  # Restart worker after N tasks
CELERY_WORKER_MAX_MEMORY_PER_CHILD=5000000  # 5GB in KB

# Broker and result backend
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/1
CELERY_RESULT_BACKEND=redis://:${REDIS_PASSWORD}@redis:6379/2

# =============================================================================
# APPLICATION PERFORMANCE
# =============================================================================
# Uvicorn workers (production)
WORKERS_COUNT=4

# Logging
LOG_LEVEL=info  # debug, info, warning, error, critical

# =============================================================================
# SECURITY & CORS
# =============================================================================
# Allowed CORS origins (comma-separated)
# Note: Port 5173 is Vite dev server default, 3000 is legacy support
CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173,http://localhost:3000,http://127.0.0.1:3000

# Allowed hosts (comma-separated)
ALLOWED_HOSTS=localhost,127.0.0.1

# =============================================================================
# FRONTEND BUILD VARIABLES (Vite)
# =============================================================================
# Note: Vite requires VITE_ prefix for environment variables
VITE_API_BASE_URL=http://localhost:8000
VITE_WS_URL=ws://localhost:8000
VITE_APP_NAME=BookReader AI
VITE_DEBUG=true
VITE_ENVIRONMENT=development

# Legacy React app variables (deprecated - use VITE_ prefix)
# REACT_APP_API_URL=http://localhost:8000
# REACT_APP_WS_URL=ws://localhost:8000

# =============================================================================
# MONITORING (Optional)
# =============================================================================
# Prometheus metrics
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_USER=admin
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(24))"
GRAFANA_PASSWORD=REPLACE_WITH_GENERATED_SECRET_MIN_24_CHARS

# PGAdmin (dev only)
PGADMIN_EMAIL=admin@bookreader.local
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(24))"
PGADMIN_PASSWORD=REPLACE_WITH_GENERATED_SECRET_MIN_24_CHARS

# =============================================================================
# WEB PUSH (VAPID) CONFIGURATION (January 2026)
# =============================================================================
# Generate VAPID keys with: npx web-push generate-vapid-keys
# Required for PWA push notifications
VAPID_PUBLIC_KEY=
VAPID_PRIVATE_KEY=
VAPID_SUBJECT=mailto:admin@yourdomain.com

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================
BACKUP_ENABLED=true
BACKUP_RETENTION_DAYS=7
BACKUP_S3_BUCKET=
BACKUP_S3_ACCESS_KEY=
BACKUP_S3_SECRET_KEY=